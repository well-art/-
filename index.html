<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>智匯中心｜企業規範導航</title>
    <!-- 引入 Noto Sans TC 繁體中文字體 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Babel Standalone -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind 配置 -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              brand: {
                green: '#24a145', // 企業綠 (主色調)
                gray: '#595656',  // 灰度空間 (文字/背景)
              }
            },
            fontFamily: {
              sans: ['"Noto Sans TC"', 'sans-serif'],
            }
          }
        }
      }
    </script>
    <style>
      body {
        font-family: 'Noto Sans TC', sans-serif;
        /* 全局放大 110% (適用於主畫面及浮動視窗) */
        zoom: 1.1;
      }
      /* 隱藏滾動條但保留功能 */
      .scrollbar-hide::-webkit-scrollbar {
          display: none;
      }
      .scrollbar-hide {
          -ms-overflow-style: none;
          scrollbar-width: none;
      }
      /* 淡入動畫 */
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .animate-in {
        animation: fadeIn 0.5s ease-out forwards;
      }

      /* 列印樣式設定 (修復版) */
      @media print {
        /* 還原縮放，確保列印版面正常 */
        body {
          zoom: 1 !important;
          background-color: white !important;
          height: auto !important;
          overflow: visible !important;
        }

        /* 隱藏所有元素，使用 visibility 避免破壞 layout 結構 (針對某些瀏覽器行為) */
        /* 但對於 React root，我們需要隱藏其子元素，除了 modal */
        body * {
          visibility: hidden;
        }

        /* 顯示 Modal 及其內容 */
        .modal-container, .modal-container * {
          visibility: visible !important;
        }

        /* 定位 Modal 填滿紙張 */
        .modal-container {
          position: absolute !important;
          left: 0 !important;
          top: 0 !important;
          width: 100% !important;
          height: 100% !important; /* 或者 auto */
          margin: 0 !important;
          padding: 0 !important;
          background: white !important;
          z-index: 999999 !important;
          box-shadow: none !important;
          border-radius: 0 !important;
          overflow: visible !important;
        }

        /* 隱藏 Modal 的 Header, Footer, Overlay */
        .modal-header, .modal-footer, .modal-overlay {
          display: none !important;
        }

        /* 讓 Iframe 填滿 */
        .modal-iframe-container {
          position: absolute !important;
          top: 0 !important;
          left: 0 !important;
          width: 100% !important;
          height: 100% !important;
          display: block !important;
        }

        iframe {
          width: 100% !important;
          height: 100% !important;
          display: block !important;
          visibility: visible !important;
        }

        /* 隱藏 Loading 等其他雜項 */
        #root > div:not(.modal-container) {
          display: none !important;
        }
      }
    </style>
  <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "lucide-react": "https://esm.sh/lucide-react@^0.562.0",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
  <body class="bg-gray-50 text-brand-gray antialiased">
    <!-- 預設載入文字，React 掛載成功後會被取代 -->
    <div id="root" class="min-h-screen flex flex-col items-center justify-center text-gray-500">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-brand-green mb-4"></div>
      <p>系統載入中...</p>
      <p class="text-xs mt-2 text-gray-400">Initial Loading...</p>
    </div>

    <!-- 錯誤處理 Script -->
    <script>
      window.onerror = function(message, source, lineno, colno, error) {
        const root = document.getElementById('root');
        root.innerHTML = `
          <div class="p-8 text-center">
            <h2 class="text-2xl text-red-600 font-bold mb-4">系統發生錯誤</h2>
            <p class="text-gray-700 mb-2">無法載入應用程式。</p>
            <div class="bg-gray-100 p-4 rounded text-left overflow-auto max-w-2xl mx-auto border border-gray-300">
              <code class="text-sm text-red-500 font-mono">${message}</code>
              <div class="mt-2 text-xs text-gray-500">${source}:${lineno}:${colno}</div>
            </div>
            <p class="text-sm text-gray-500 mt-4">請嘗試重新整理頁面，或確認您的網路連線 (需要連接 CDN)。</p>
          </div>
        `;
      };
    </script>

    <script type="text/babel" data-type="module">
      /**
       * 使用固定版本的 React 18.2.0 以確保穩定性。
       */
      import React, { useState, useEffect } from 'https://esm.sh/react@18.2.0';
      import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
      import { 
        Menu, X, BookOpen, Search, LogOut, 
        Lock, ArrowRight, ShieldCheck, 
        FileText, ChevronRight, ArrowLeft, Folder, FolderOpen, MousePointerClick,
        Activity, GitMerge, Share2,
        Table, Archive, Layers, Download, ExternalLink, HelpCircle, Printer
      } from 'https://esm.sh/lucide-react@0.344.0';

      // ==========================================
      // CONSTANTS & DATA (資料層)
      // ==========================================
      const APP_CONFIG = {
        PASSWORD: '2693988',
        COLORS: {
          PRIMARY: '#24a145',
          SECONDARY: '#595656',
        },
        CONTACT_EMAIL: 'admin@company.com',
      };

      const REGULATION_CATEGORIES = [
        { id: 'org', name: '組織系列' },
        { id: 'tech', name: '技術系列' },
        { id: 'finance', name: '財務系列' },
        { id: 'marketing', name: '行銷系列' },
        { id: 'integrity', name: '品格系列' },
      ];

      const FLOWCHART_CATEGORIES = [
        { id: 'dept1', name: '一部門' },
        { id: 'dept2', name: '二部門' },
        { id: 'dept3', name: '三部門' },
        { id: 'dept4', name: '四部門' },
        { id: 'dept5', name: '五部門' },
        { id: 'dept6', name: '六部門' },
        { id: 'dept7', name: '七部門' },
      ];

      const FORM_CATEGORIES = [
        { id: 'docs', name: '文書檔案' },
        { id: 'seals', name: '印鑑相關' },
        { id: 'finance_form', name: '財務相關' },
        { id: 'hr', name: '人事相關' },
        { id: 'pr', name: '公關相關' },
        { id: 'mgmt', name: '管理相關' },
        { id: 'profit', name: '穩盈相關' },
      ];

      // 真實資料 - 更新至最新 (依據照片資料)
      const REGULATIONS_DATA = [
        // --- 組織系列 (Organization) - 0~58 (已於前次更新確認) ---
        { id: 'reg_org_0', title: '0. 工作規則', date: '2023/12/07', url: 'https://drive.google.com/file/d/162Ypn3-kp7ENhSdJ2KByYrH3zWxyPCdl/preview', description: '規範勞資雙方權利義務。', category: 'org', isNew: true },
        { id: 'reg_org_1', title: '1. 目標與目的規章', date: '2025/02/01', url: 'https://docs.google.com/document/d/1eTqS3bMABIexMjFmjighRF-932K-iwYtxGCuxTqi7SA/preview', description: '明確定義公司的短期目標與長期願景。', category: 'org' },
        { id: 'reg_org_2', title: '2. 公司歷史規章', date: '2025/02/01', url: 'https://docs.google.com/document/d/1sqckdA0LorOmgAPLTPVcd5IX9glpY6JrCnDpLE011BU/preview', description: '記錄公司發展歷程。', category: 'org' },
        { id: 'reg_org_3', title: '3. 最終有價值產品規章', date: '2025/02/01', url: 'https://docs.google.com/document/d/1LkRpu50VcovwOldcXcVf62ZjN-Vc0ghpha82SM2XSx8/preview', description: '定義公司各職位最終應交付的有價值產品。', category: 'org' },
        { id: 'reg_org_4', title: '4. 組織圖使用規章', date: '2025/02/01', url: 'https://docs.google.com/document/d/1Uo1MSRM_Wk60sPmbzSRisHozcB5aEYn6y0C3sE4XmdY/preview', description: '闡述組織架構圖之閱讀方式。', category: 'org' },
        { id: 'reg_org_5', title: '5. 各課的職責', date: '2025/02/01', url: 'https://docs.google.com/document/d/1ku0Ej2LLShAs8LZzGINfrTEOmOVT2U422_cU4DoYAsQ/preview', description: '詳細列出各課級單位的職掌範圍。', category: 'org' },
        { id: 'reg_org_6', title: '6. 每週職員會議規章', date: '2025/02/01', url: 'https://docs.google.com/document/d/1ohWmuWllovNUWZ-n_q9jOXY2-cUC-ACAUQJ8sEyCXZQ/preview', description: '規範每週例會的進行流程。', category: 'org' },
        { id: 'reg_org_7', title: '7. 書面溝通規章', date: '2025/02/01', url: 'https://docs.google.com/document/d/1iaUQH5ld4MwWAbUg7Cnaw9EXpm6yCSTqj-T9XUUzpX0/preview', description: '定義內部文書往來的格式。', category: 'org' },
        { id: 'reg_org_8', title: '8. 命令規章', date: '2025/02/01', url: 'https://docs.google.com/document/d/1Tc1y9xmOER4fa6lJ0JR5YHlGpYI13RDrb585Xi4Mg5w/preview', description: '闡述上級下達命令的標準程序。', category: 'org' },
        { id: 'reg_org_9', title: '9. CSW規章', date: '2025/02/01', url: 'https://docs.google.com/document/d/1lU7gyS4a1zoKhOJA4_WUqelVHQ0pr2fiFUdxGPuLrI8/preview', description: '完成職員工作（CSW）的標準定義。', category: 'org' },
        { id: 'reg_org_10', title: '10. 工作資料夾規章', date: '2025/02/01', url: 'https://docs.google.com/document/d/1LL5FQQwiqjJf8MaXXUwUPBhqEmDSmhfKm95CcyEpDPI/preview', description: '規範個人工作資料的分類與歸檔。', category: 'org' },
        { id: 'reg_org_11', title: '11. 工作資料夾檢視規章', date: '2025/02/01', url: 'https://docs.google.com/document/d/1Z-A26U00KEfRUfp2pGWUmHVkU1N_lElXT3yCT790jZw/preview', description: '主管定期檢視工作資料夾的標準。', category: 'org' },
        { id: 'reg_org_12', title: '12. 如何撰寫規章的規章', date: '2025/02/01', url: 'https://docs.google.com/document/d/1c3sAQv1uzgKfm3w3jPlLBdlzXlOfv3SIBVPxLRursIo/preview', description: '制定公司內部規章文件的標準格式。', category: 'org' },
        { id: 'reg_org_13', title: '13. 統計曲線規章', date: '2025/02/01', url: 'https://docs.google.com/document/d/1qNhw6b_9OM3q-HSjuZbNsK6svpiwFMRRyd0TGsNTfEU/preview', description: '說明如何繪製與解讀績效統計曲線。', category: 'org' },
        { id: 'reg_org_14', title: '14. 職員出勤規章', date: '2025/02/06', url: 'https://docs.google.com/document/d/17wdy8YJ-IeBDUjsmLi0pSYYF572BPvH3_WRaHUL3ctM/preview', description: '規定打卡、遲到早退、加班與休假。', category: 'org' },
        { id: 'reg_org_15', title: '15. 如何修改公司管理工具規章', date: '2025/01/20', url: 'https://docs.google.com/document/d/1nzs_RmDkEtFRlzozNbHthElDOJTH1H9ulqD33Gtj54g/preview', description: '定義管理系統的變更流程。', category: 'org' },
        { id: 'reg_org_16', title: '16. 辦公室用品操作與管理規章', date: '2025/02/01', url: 'https://docs.google.com/document/d/1INOPF34RMO_gUh5gegOBNSwK101r9Z78e17Er8E7T9Y/preview', description: '規範辦公設備與耗材的管理規則。', category: 'org' },
        { id: 'reg_org_17', title: '17. 印鑑與負責人簽名管理規章', date: '2024/06/14', url: 'https://docs.google.com/document/d/1R7dp1eWYWbbhM4SoHly1dZPdHs0pShHL3OWjMVGcuRI/preview', description: '控管公司大小章及簽名使用權限。', category: 'org' },
        { id: 'reg_org_18', title: '18. 協調手冊', date: '2024/04/18', url: 'https://docs.google.com/document/d/1NfBiBdyS7Pf4mlhbsYuZrleas88Ga_t-Sbw4OVfyT8E/preview', description: '跨部門溝通與衝突解決原則。', category: 'org' },
        { id: 'reg_org_19', title: '19. 如何移轉職責', date: '2024/04/22', url: 'https://docs.google.com/document/d/11iA-peENwzDCVinKlT_FMuEjD6hzpjyY9qPAY9XTNtw/preview', description: '職務交接與職責移轉確認流程。', category: 'org' },
        { id: 'reg_org_20', title: '20. 如何開始在新職位上運作', date: '2024/04/22', url: 'https://docs.google.com/document/d/10Yc-fZfdW_CtTuARuPov0NVvM95YNSTDZ_eVfuYb3-o/preview', description: '新進或異動人員的快速上手指南。', category: 'org' },
        { id: 'reg_org_21', title: '21. 企業主10年戰略方針', date: '2024/08/21', url: 'https://docs.google.com/document/d/1FkCVnLRd0mhCGDsbFaEvoyVZXSDn7NzXwCBhvw7Miss/preview', description: '企業未來發展藍圖與戰略目標。', category: 'org' },
        { id: 'reg_org_22', title: '22. 管理等級表(2025年版)', date: '2024/08/21', url: 'https://docs.google.com/document/d/1_IRQ1fhBttZnYvCnnwtXELGCFAaOYhKrVQFhxdewc3I/preview', description: '公司內部管理職級體系表。', category: 'org' },
        { id: 'reg_org_23', title: '23. 個人職務說明培訓', date: '2024/04/22', url: 'https://docs.google.com/document/d/1JmFMkUXkYe2k3SRL0tNG_IbBl5KtwOr-IJZy48-q7RA/preview', description: '職務說明書內容的教育訓練。', category: 'org' },
        { id: 'reg_org_24', title: '24. 主管的責任', date: '2024/04/22', url: 'https://docs.google.com/document/d/1eQbbZOSe61-zxRrsyPoUQU9ygNIQX6EgOtcADgSOM4A/preview', description: '各級主管的領導與績效責任。', category: 'org' },
        { id: 'reg_org_25', title: '25. 腦力激盪', date: '2024/05/02', url: 'https://docs.google.com/document/d/1zDHVImzFwPgxILJje9qjSQFZu5OiQ_WtHlWNFOuQ0PM/preview', description: '創意發想會議進行方式。', category: 'org' },
        { id: 'reg_org_26', title: '26. 應付與組織規章', date: '2024/05/13', url: 'https://docs.google.com/document/d/1Ec6bN0ePj2iLtJNicWaimW71AeynIfgT7REUyV5bzJw/preview', description: '組織突發狀況或危機的應變機制。', category: 'org' },
        { id: 'reg_org_27', title: '27. 年度計畫規章', date: '2025/01/06', url: 'https://docs.google.com/document/d/1LSoCk9inoTTUC4BA-yXCss6HiU9mXwapfAOXkzi-0Gg/preview', description: '年度營運計畫制定與執行。', category: 'org' },
        { id: 'reg_org_28', title: '28. 集團行事曆規章', date: '2024/11/14', url: 'https://docs.google.com/document/d/1VC2NhVz4pfi0dMLiIxrIWkhx2iWLH7BReCfDRoY2xto/preview', description: '集團重要活動與行事曆管理。', category: 'org' },
        { id: 'reg_org_29', title: '29. 職員終止契約與職務移轉規章', date: '2025/03/06', url: 'https://docs.google.com/document/d/1O43I83txCawPkKjiD0nOecEbSgrGWtnmoucxmnFq6nM/preview', description: '離職契約終止與工作交接。', category: 'org' },
        { id: 'reg_org_30', title: '30. 職務說明_公版', date: '2024/07/15', url: 'https://docs.google.com/document/d/13y4I-WmtBJZM7Gf2-5Uds0LqfwQYP16n/preview', description: '標準化職務說明書範本。', category: 'org' },
        { id: 'reg_org_31', title: '31. 職務職責與運行規章', date: '2024/11/14', url: 'https://docs.google.com/document/d/11KSGIeCLfk97jXwmP09DMkhhl0z2O9fwxBoTtjmj54s/preview', description: '職務職責履行與日常運行準則。', category: 'org' },
        { id: 'reg_org_32', title: '32. 出差費用管理辦法規章', date: '2024/08/15', url: 'https://docs.google.com/document/d/1DiCgOu38eg1RpdBXQjUY2qr6RcWn9Uw0ZJesmVnzWCQ/preview', description: '國內外出差費用報支標準。', category: 'org' },
        { id: 'reg_org_33', title: '33. 職務移轉規章附件', date: '2024/07/15', url: 'https://docs.google.com/document/d/1-yTTqGmEaMeq_hVA5wvtuCKfa5hj6cYiBLB-FpGytjA/preview', description: '職務移轉附件表格。', category: 'org' },
        { id: 'reg_org_34', title: '34. 職務移轉規章', date: '2024/07/15', url: 'https://docs.google.com/document/d/11iA-peENwzDCVinKlT_FMuEjD6hzpjyY9qPAY9XTNtw/preview', description: '職務移轉標準作業流程。', category: 'org' },
        // --- 修正：將項目 35 移至組織系列 (org) ---
        { id: 'reg_org_35', title: '35. 投資客戶資料管理規則', date: '2025/02/06', url: 'https://docs.google.com/document/d/13NNiO_cmzUF2T3egu8phmUijc-lFKASpeNjv-4pjobg/preview', description: '投資客戶個資保護與管理。', category: 'org' },
        { id: 'reg_org_36', title: '36. 戰略與戰術會議規章', date: '2025/02/06', url: 'https://docs.google.com/document/d/1wMquAiR4Sso1svSW4yub_Bw1XjaZXe47JubtgdjrtgM/preview', description: '會議運作模式定義。', category: 'org' },
        { id: 'reg_org_37', title: '37. 企業文件審核規範', date: '2025/02/27', url: 'https://docs.google.com/document/d/14rlMJ89loSK-S_wFWkkKkM_xXc2TRKETlzKNDnohRew/preview', description: '文件發布審核機制。', category: 'org' },
        { id: 'reg_org_38', title: '38. 簽約獎金政策規章', date: '2025/03/27', url: 'https://docs.google.com/document/d/18D1Dp3E3zfajABxt8SenCrOY_in4ZWBziJQLU2mwbPs/preview', description: '獎金計算與發放條件。', category: 'org' },
        { id: 'reg_org_39', title: '39. 專案管理規章', date: '2025/03/27', url: 'https://docs.google.com/document/d/1eSRecDt0eCfGVVz0ggKvq35KBXEOsNRHmuFahvH9RXg/preview', description: '專案全生命週期管理。', category: 'org' },
        { id: 'reg_org_40', title: '40. 合約規章', date: '2025/04/16', url: 'https://docs.google.com/document/d/1OO2wFVBE0IO6pPie8nCVRnd3BysVr2FcK13TuB6m_dc/preview', description: '合約擬定與審閱規範。', category: 'org' },
        { id: 'reg_org_41', title: '41. 年度目標展開與執行流程規章', date: '2025/04/18', url: 'https://docs.google.com/document/d/1zwgQyS4rba3aayyNZ8XQvM2wUQa6z1csKlTcozGi_bM/preview', description: '年度目標KPI拆解流程。', category: 'org' },
        { id: 'reg_org_42', title: '42. 人力招募與任用', date: '2025/05/23', url: 'https://docs.google.com/document/d/13aSUbNn7gz1E-Gcn0Mlp5Tt8uTd6ukdWCXaZPNhE54E/preview', description: '人才甄選任用程序。', category: 'org' },
        { id: 'reg_org_43', title: '43. 職員內部公關', date: '2025/06/13', url: 'https://docs.google.com/document/d/1vIk5lgpCBvVqkjR299-uq0mglQ4L_JFMVb8B96p1ljc/preview', description: '內部溝通與關係維護。', category: 'org' },
        { id: 'reg_org_44', title: '44. 感謝小卡', date: '2025/06/13', url: 'https://docs.google.com/forms/d/e/1FAIpQLSeZvkR5M8M31ryjYwSzj5f3tRnNFf17GVcmsqHo0VTDtufc2w/viewform', description: '內部感恩文化推動。', category: 'org' },
        { id: 'reg_org_45', title: '45. 穩盈策略顧問股份有限公司_行政管理等級表', date: '2025/06/13', url: 'https://docs.google.com/document/d/14ekkF3a2lNY5VGtdep5u6v4-usQ-lkeePc4txia_nHY/preview', description: '行政職級與權限表。', category: 'org' },
        { id: 'reg_org_46', title: '46. 企業宣傳與教育發布規範', date: '2025/06/20', url: 'https://docs.google.com/document/d/1lBqwNgG_fX2mlANTlYeDgITpHOxWD8sVgv43t979nWk/preview', description: '對外宣傳與教材發布標準。', category: 'org' },
        { id: 'reg_org_47', title: '47. 職災處理辦法', date: '2025/06/20', url: 'https://docs.google.com/document/d/1vFL9JKH89MYZxtRJl7wOz88-I-Mna1-30y6inRJ9FIo/preview', description: '職業災害通報與處理。', category: 'org' },
        { id: 'reg_org_48', title: '48. 文書檔案管理', date: '2025/06/20', url: 'https://docs.google.com/document/d/1Wq7q3OQp-0LqPYOFmoUvmct5vyMiY2qd/preview', description: '文件編碼與歸檔規則。', category: 'org' },
        { id: 'reg_org_49', title: '49. 文件審查規章', date: '2025/07/16', url: 'https://docs.google.com/document/d/13BVLST5ywds1CTy91HU2498WJ2D1j9NRipKS2pJysRs/preview', description: '發行文件之審查機制。', category: 'org' },
        { id: 'reg_org_50', title: '50. 職員訓練規範與必要性', date: '2025/07/30', url: 'https://docs.google.com/document/d/1myS9midHkhTC4WIrJNMRld1wsB1sJ56OGxAttYs061g/preview', description: '教育訓練體系說明。', category: 'org' },
        { id: 'reg_org_51', title: '51. 會議規章', date: '2025/07/31', url: 'https://docs.google.com/document/d/1lr1oE7VFL8Csr5bWv00aC_-aPI-e9UWYz3PuGhIFJOI/preview', description: '會議召集與紀錄規範。', category: 'org' },
        { id: 'reg_org_52', title: '52. 流程圖製作與審核', date: '2025/09/05', url: 'https://docs.google.com/document/d/1zSHcN0Ticx7o375NBkU3M4bdYqv9wA2ge5jn8BSKWWU/preview', description: 'SOP流程圖繪製標準。', category: 'org' },
        { id: 'reg_org_53', title: '53. 法律案件責任與協作管理', date: '2025/11/13', url: 'https://docs.google.com/document/d/11oKV6mLijdVG5L9cNJdi0wmhce3MKhLp49s5DB05XOQ/preview', description: '訴訟案件處理權責。', category: 'org' },
        { id: 'reg_org_54', title: '54. 獎金與激勵辦法', date: '2025/11/20', url: 'https://docs.google.com/document/d/1LaZNZfvdwmx3SJicbm8l22j-UHfGJPG7pZzUeEcgVz0/preview', description: '績效獎金核發標準。', category: 'org' },
        { id: 'reg_org_55', title: '55. 績效管理與考核辦法', date: '2025/11/07', url: 'https://docs.google.com/document/d/1o8f_penur56ymLaKpJke3cYBGrcjqxB6KDjFSI7q8NE/preview', description: '績效考核制度。', category: 'org' },
        { id: 'reg_org_56', title: '56. 薪酬結構辦法', date: '2025/11/07', url: 'https://docs.google.com/document/d/1qJfjUte_VEVqwMjIYi1vA9Lm_8sRYOD34zBiwpaRUgg/preview', description: '薪資組成原則。', category: 'org' },
        { id: 'reg_org_57', title: '57. 職員培訓辦法', date: '2025/11/14', url: 'https://docs.google.com/document/d/1I-RB7rBn99vvmQMNyh9BVevA13UW3po4LMU6iGZ5Wno/preview', description: '培訓申請與公假規範。', category: 'org' },
        { id: 'reg_org_58', title: '58. 職員發展與晉升辦法', date: '2025/11/14', url: 'https://docs.google.com/document/d/1NnMTD1e8xLOemtLwQzqVJhkHIm1FX9dvnBPChEGfHAo/preview', description: '職涯發展與晉升條件。', category: 'org' },

        // --- 技術系列 (Technology) - Updated from new Image 1 ---
        { id: 'reg_tech_1', title: '1. 公佈欄發布規章', date: '2024/12/05', url: 'https://docs.google.com/document/d/1-xUgpXYp5hVb4IYzvmq4KJtxyOwa9Z00YBytMvqPi54/preview', description: '規範公司實體與數位公佈欄的資訊張貼。', category: 'tech' },
        { id: 'reg_tech_2', title: '2. 應收帳款分期客戶合約到期展期', date: '2024/07/03', url: 'https://docs.google.com/document/d/1Ksv32RKYyyloO12G1adtfgZ7A3WQTTNzc_olZAXExLs/preview', description: '客戶分期合約到期後的續約評估。', category: 'tech' },
        { id: 'reg_tech_3', title: '3. 帳務系統操作手冊', date: '2024/09/02', url: 'https://docs.google.com/document/d/1xMCeaP-ayd9O6AGueHyTMRS0bbJGvPGLZmz4JNoJslI/preview', description: '內部帳務管理系統操作指南。', category: 'tech' },
        { id: 'reg_tech_4', title: '4. 不動產鑑價作業規章', date: '2024/12/17', url: 'https://docs.google.com/document/d/1_82d8VjrequcHkIJKNryNNBlOTBYp7Cs9O3ReyChSPU/preview', description: '不動產價值評估流程。', category: 'tech' },
        { id: 'reg_tech_5', title: '5. 財富奧秘之旅玩家指南規章', date: '2024/11/14', url: 'https://docs.google.com/document/d/15S_ZiwellhyuMvi_6ZqkU9UIhjHYvx_beaeY_5P4fj8/preview', description: '財富遊戲化教育訓練規則。', category: 'tech' },
        { id: 'reg_tech_6', title: '6. 銀行金鑰管理規章', date: '2024/05/20', url: 'https://docs.google.com/document/d/1meaTo3hZrCpbVr3utXUu_2G_WI-fAYElqq2HaYv2AKE/preview', description: '網銀憑證保管與權限控管。', category: 'tech' },
        { id: 'reg_tech_7', title: '7. 客戶借款違約金減免規範', date: '2025/07/30', url: 'https://docs.google.com/document/d/17HSjUqnDgEdTwR3dr_hZjs8fMoTNEcSC/preview', description: '違約金減免審核標準。', category: 'tech' },
        { id: 'reg_tech_8', title: '8. 案件授信準則', date: '2025/05/12', url: 'https://docs.google.com/document/d/1jD6f8k69cWaGDYW599A59oBXUXnPki4J/preview', description: '風險評估與核貸條件。', category: 'tech' },
        { id: 'reg_tech_9', title: '9. 案件催收壓力等級表', date: '2024/03/20', url: 'https://docs.google.com/document/d/1SMH-AgOZAKoTICJj9OF-j6mPeLBx67lJ/preview', description: '逾期案件分類與催收強度。', category: 'tech' },
        { id: 'reg_tech_10', title: '10. 個案合約審核及管理辦法', date: '2025/07/11', url: 'https://docs.google.com/document/d/1LKFe8k9ykFYdW-FKa1cNt2faqG8zczUrOFuNf7EOgZg/preview', description: '特殊合約法務審核流程。', category: 'tech' },
        { id: 'reg_tech_11', title: '11. 不動產擔保提供報酬規範', date: '2025/07/11', url: 'https://docs.google.com/document/d/1TB7iIazCdSpNTQ9xlbU9l4Owa1uYy0R9ZVL9m8aP52k/preview', description: '擔保品報酬計算與支付。', category: 'tech' },
        { id: 'reg_tech_12', title: '12. 案件移轉辦法', date: '2025/07/16', url: 'https://docs.google.com/document/d/1ZIQ6u0c8melyW2qfIcfQjhNtrHr7RjCqcoBfOoij3HI/preview', description: '案件權益移轉程序。', category: 'tech' },
        { id: 'reg_tech_13', title: '13. 投資人會員分級規章', date: '2025/07/31', url: 'https://docs.google.com/document/d/1SinDUT_rduYlov2kbs32mhf3V6H-Ra1VcPgvRov1rkE/preview', description: '投資人分級與服務差異。', category: 'tech' },
        { id: 'reg_tech_14', title: '14. 投資人投資流程規章', date: '2025/08/14', url: 'https://docs.google.com/document/d/1Mwde1iuceOSp-vRpXuGN5Sz8TwgbQ5rLJLEexVMSf8Y/preview', description: '投資標準作業程序。', category: 'tech' },
        { id: 'reg_tech_15', title: '15. 投資人退資流程規章', date: '2025/08/14', url: 'https://docs.google.com/document/d/1XuOBsViU9XRXkdrWlZm7P9QDu2fY_DxD1brEmnJL5cg/preview', description: '退資申請與結算撥款。', category: 'tech' },
        { id: 'reg_tech_16', title: '16. 投資通路管理規範', date: '2025/09/05', url: 'https://docs.google.com/document/d/1Es4kjY_Ka3feA-3Um3WeHkTLtn0AqoqoQ-drOkArrII/preview', description: '資金渠道合作與佣金制度。', category: 'tech' },
        { id: 'reg_tech_17', title: '17. 客戶逾期支付利息管理與減免辦法', date: '2025/10/17', url: 'https://docs.google.com/document/d/1v-PUTO8GOL4Xnca8bY2bGkPZU5ezo4Dd7N-1SWF9l2Q/preview', description: '逾期利息計算與減免申請。', category: 'tech' },

        // --- 財務系列 (Finance) - Updated from new Image 2 ---
        { id: 'reg_fin_1', title: '1. 財務計畫3.0規章', date: '2025/02/06', url: 'https://docs.google.com/document/d/1d1Y96RYF7BVznr67jlPZeK-G7l0NoLJCmJzS48js-uU/preview', description: '財務規劃與預算執行準則。', category: 'finance' },
        { id: 'reg_fin_2', title: '2. 集團內部借貸規則', date: '2024/12/25', url: 'https://docs.google.com/document/d/1Y4Z7HRLAmPXZst3Bzt3ZFLpgszUcUqFQJyBoN9c_fNE/preview', description: '子公司間資金調度程序。', category: 'finance' },
        { id: 'reg_fin_3', title: '3. 借款案件報價與獎勵規章', date: '2025/02/27', url: 'https://docs.google.com/document/d/1ZvVhP_00-W_KpbqmSRcZybi7TMb49YpFAHB7aPK4KnA/preview', description: '利率定價與業務獎勵。', category: 'finance' },
        { id: 'reg_fin_4', title: '4. 財務及會計規章', date: '2025/03/31', url: 'https://docs.google.com/document/d/1alDWigBxatL-w9pdk_OgBeRI7IH5uwqwWeiRbliqOD8/preview', description: '會計帳務與稅務申報。', category: 'finance' },

        // --- 行銷系列 (Marketing) - Updated from new Image 3 ---
        { id: 'reg_mkt_1', title: '1. 行銷外包規定', date: '2025/02/06', url: 'https://docs.google.com/document/d/1HanQAEhbq2AwcUQ6si-zVPObSR00Hgxf-8vQGmJC8wA/preview', description: '行銷專案委外與成效評估。', category: 'marketing' },

        // --- 品格系列 (Integrity) - Updated from new Image 4 ---
        { id: 'reg_int_1', title: '1. 示知報告規章', date: '2025/02/01', url: 'https://docs.google.com/document/d/1DQwl2vBspWVvss4bI_8jblDjPAm9-C7s4T9jGPgdteE/preview', description: '異常狀況通報程序。', category: 'integrity' },
        { id: 'reg_int_2', title: '2. 品格梯度階層規章', date: '2025/02/01', url: 'https://docs.google.com/document/d/1fdNprYV3AAqPJ5Lb-DgroRNose8N1vzOpoT1tqXbUMg/preview', description: '品格道德標準與行為準則。', category: 'integrity' },
        { id: 'reg_int_3', title: '3. 狀況公式', date: '2024/04/18', url: 'https://docs.google.com/document/d/1n3NZnFDRYbCKX2HdfmFNzyDXt0uiSi2OUnE9iaBjAN4/preview', description: '處境判斷與應對公式。', category: 'integrity' },
        { id: 'reg_int_4', title: '4. 如何清字', date: '2024/04/22', url: 'https://docs.google.com/document/d/1l_y605Cbgb5ov2dR660sHLWi4TMrZK7QuprJqMeqHyk/preview', description: '學習技術與字詞釐清。', category: 'integrity' },
        { id: 'reg_int_5', title: '5. 多事資料', date: '2024/12/26', url: 'https://docs.google.com/document/d/10Nt-wP8WNBX80ZcLmna7eodAo5J9p-0V97Jvg4wJgZw/preview', description: '識別內部潛在麻煩來源。', category: 'integrity' },
        { id: 'reg_int_6', title: '6. 阻止口頭技術規章', date: '2024/06/27', url: 'https://docs.google.com/document/d/1GjFhHPYZcbLptKCphDnFzevhC5n0tTmuZU6bYrdPS04/preview', description: '落實書面溝通文化。', category: 'integrity' },
        { id: 'reg_int_7', title: '7. 生存與動機', date: '2024/09/05', url: 'https://docs.google.com/document/d/1_krjuq4XBAViuTjQM55EgW51TwJ0bks06uyBu6lvg3Q/preview', description: '激發正向工作動力。', category: 'integrity' },
        { id: 'reg_int_8', title: '8. 快速流動行動週期與品格', date: '2024/09/05', url: 'https://docs.google.com/document/d/1S5dxCdUybg45vQMCQ6t5QJn0xCbH98dwPdnu6Grc8iY/preview', description: '高效率執行與品格結合。', category: 'integrity' },
        { id: 'reg_int_9', title: '9. 辦公室戀愛管理規章', date: '2024/12/04', url: 'https://docs.google.com/document/d/1T6yOfQ3vPctMfPnPXr7vr0B1wQOiYOY5czlbEO48KQ8/preview', description: '辦公室戀情申報與規範。', category: 'integrity' },
        { id: 'reg_int_10', title: '10. 檢視職員的必要性', date: '2025/06/13', url: 'https://docs.google.com/document/d/1FEuce0ZZtDbDjs9LdDljIzl1p8RT1Qtcqfx9lVAEgmQ/preview', description: '職位價值與適任性評估。', category: 'integrity' },
      ];

      // 粒子流程表 - 根據圖片更新項目與日期 (保持不變)
      const FLOWCHARTS_DATA = [
        { id: 'flow_d1_3', title: '出差申請粒子流程表', date: '2024/09/05', url: 'https://docs.google.com/document/d/1TO1GRS2AiGpBUAlfqA02v4I5xfMln3Z7ZACk07ef1II/preview', description: '員工出差申請標準流程。', category: 'dept1' },
        { id: 'flow_d1_4', title: '離職流程表(自請離職版)', date: '2024/09/05', url: 'https://docs.google.com/document/d/1yKxLUiTrSKajfDJi4ThT_bUHPiE3T7JRfAkToR8hmus/preview', description: '員工自願離職程序。', category: 'dept1' },
        { id: 'flow_d1_5', title: '離職流程表(非自願離職版)', date: '2024/09/05', url: 'https://docs.google.com/document/d/1pVVU7deYNCG1d34O1fVi8Qj5bWb5m0XbK3tV9yf_bkE/preview', description: '非自願離職處理程序。', category: 'dept1' },
        { id: 'flow_d1_6', title: '加速員30天挑戰賽流程表', date: '2025/09/22', url: 'https://docs.google.com/document/d/13tt2ByyQUgaCpuXp2yEFXEbtE0s70AWg/preview', description: '新進人員首月挑戰任務。', category: 'dept1' },
        { id: 'flow_d1_1', title: '薪資發放粒子流程表', date: '2024/10/23', url: 'https://docs.google.com/document/d/1debhkhgq-GItRL5_73hLP184O41lrvPQijXTXL5akaU/preview', description: '每月薪資結算流程。', category: 'dept1' },
        { id: 'flow_d1_2', title: '請假粒子流程表', date: '2024/11/21', url: 'https://docs.google.com/document/d/1A7gUZfBoFCOIG05gK5n4e9aCaAArmaLH/preview', description: '請假申請與簽核步驟。', category: 'dept1' },
        { id: 'flow_d2_1', title: '投資人投資粒子流程表', date: '2025/07/16', url: 'https://docs.google.com/document/d/1osLdqtDlozKHgtQSlnJ54p17yiqXWH277jE3g6AJ6oY/preview', description: '投資人入資標準服務流程。', category: 'dept2' },
        { id: 'flow_d2_2', title: '投資人退資粒子流程表', date: '2025/07/31', url: 'https://docs.google.com/document/d/1G7ydw_fUQVtqOnERpv6YGF0BVr5QSHyLP-IfpYSngTw/preview', description: '投資人退資申請流程。', category: 'dept2' },
        { id: 'flow_d3_1', title: '採購單流程表', date: '2024/09/24', url: 'https://docs.google.com/document/d/1OfZqaBb1Qtf70nP294GgAm9wlz_2TKmQ28MubXyvwQo/preview', description: '採購申請與驗收付款。', category: 'dept3' },
        { id: 'flow_d3_2', title: '客戶清償流程表', date: '2024/08/29', url: 'https://docs.google.com/document/d/1Aj0ywbHU1yEmETEThFRCw0g7vwA8ZMUpOwzUmr-uB3U/preview', description: '客戶結清債務與清償證明。', category: 'dept3' },
        { id: 'flow_d3_3', title: '財務計畫粒子流程表', date: '2024/09/12', url: 'https://docs.google.com/document/d/14g1tBbm0y3CcPher_leU-l4vKxGqha_LMLt4bT0H3ps/preview', description: '預算編列與資金分配。', category: 'dept3' },
        { id: 'flow_d3_4', title: '案件催收流程表', date: '2024/08/16', url: 'https://docs.google.com/document/d/18tiSDDb__ThxiY8Db8AjCAtOZPSKhcSFmDyVOxPmbxA/preview', description: '逾期案件催收處置。', category: 'dept3' },
        { id: 'flow_d4_1', title: '案件代償流程表', date: '2024/10/29', url: 'https://docs.google.com/document/d/1lfRdOaJCPXihBizer5SsMYin8Ia_yYmkiwK6NzjyHe8/preview', description: '代償案件申請審核。', category: 'dept4' },
        { id: 'flow_d4_2', title: '案件對保撥款流程表', date: '2024/11/14', url: 'https://docs.google.com/document/d/1W3SvKNV9c9oSKrg0gH_qbx5mEIkhlsOaBSLtOUNA8zE/preview', description: '簽約對保與撥款作業。', category: 'dept4' },
        { id: 'flow_d5_1', title: '訓練申請粒子流程表', date: '2025/03/06', url: 'https://docs.google.com/document/d/1uY4Ha0NnTNnUeDLSc-eJVTy59vl9SNIvsliexrCLvIw/preview', description: '培訓需求申請流程。', category: 'dept5' },
        { id: 'flow_d7_1', title: '合約簽立粒子流程表', date: '2025/04/10', url: 'https://docs.google.com/document/d/1h6lNL7Ndd3njY11bm7f6AT5NmN7244EFdUXOk73Zjo4/preview', description: '合約擬定與簽署步驟。', category: 'dept7' },
        { id: 'flow_d7_2', title: '發布審核粒子流程表', date: '2025/11/11', url: 'https://docs.google.com/document/d/1LxdbMT10tslZIKkA92RepntSr8qcAptatr5yUGjn1nU/preview', description: '對外發布內容審查。', category: 'dept7' },
      ];

      const FORMS_DATA = [
        // --- 文書檔案 (Docs) ---
        { id: 'form_doc_1', title: '1. 結案標籤格式', date: '', url: 'https://docs.google.com/document/d/1xhSOS_syFtsDOGfFzAZPoCo3onUYi-dz/preview', description: '專案或案件結案歸檔時，文件夾脊背與封面的標準標籤格式範本。', category: 'docs' },
        { id: 'form_doc_2', title: '2. 融鎰多孔夾封面命名格式', date: '', url: 'https://docs.google.com/document/d/1D5a0yClbA4CP53BrWFvTgph4sEUj3jPK/preview', description: '統一規範多孔夾封面的命名規則與排版樣式。', category: 'docs' },
        { id: 'form_doc_3', title: '3. 一般多孔夾封面命名格式', date: '', url: 'https://docs.google.com/document/d/1GxWjYNoqOXVxo0j65Qe2ltqN6A1En_we/preview', description: '通用版多孔夾封面的標準命名與排版格式。', category: 'docs' },
        { id: 'form_doc_4', title: '4. 內頁標籤格式', date: '', url: 'https://docs.google.com/document/d/1kOWV7in-8fnjHCbjIYzd8hNUrabuN37S/preview', description: '文件內頁分類標籤的標準格式範本。', category: 'docs' },
        { id: 'form_doc_5', title: '5. 勾選式目錄格式', date: '', url: 'https://docs.google.com/document/d/12XtAcbalPwVwNUl6F95G0EKtbPbsrvHH/preview', description: '標準化的勾選式目錄表格，用於文件核對與索引。', category: 'docs' },
        
        // --- 印鑑相關 (Seals) ---
        { id: 'form_seal_1', title: '1. 印鑑刻製申請單', date: '', url: 'https://docs.google.com/document/d/1o1FYHaDyp0hg-e8sTuer0vdKAqvJdEGnQaTCatj1POE/preview', description: '申請新刻公司章、部門章或職務章的標準申請表格。', category: 'seals' },
        { id: 'form_seal_2', title: '2. 印鑑遺失/報銷申請單', date: '', url: 'https://docs.google.com/document/d/1f7aIZMYtX-S5ZNcJd5XoR8Z3NMtCFlm8/preview', description: '印鑑遺失申報或磨損報廢時使用的正式紀錄與審核單據。', category: 'seals' },
        { id: 'form_seal_3', title: '3. 用印申請CSW', date: '', url: 'https://docs.google.com/document/d/1aU1da1CnhxbQAO_BUCgWdaAZM029mVb9/preview', description: '符合CSW標準的用印申請文件，確保用印權限與文件內容經完整審核。', category: 'seals' },

        // --- 財務相關 (Finance) ---
        { id: 'form_fin_1', title: '1. 資金申請單', date: '', url: 'https://docs.google.com/document/d/1UdVNHe4b4dT9XJkyX0kUUT_OXnPFmacc/preview', description: '各部門申請專案資金、採購費用或日常支出的標準請款表格。', category: 'finance_form' },

        // --- 人事相關 (HR) ---
        { id: 'form_hr_1', title: '1. 招聘需求單', date: '', url: 'https://docs.google.com/document/d/1chwykCKL08v2k8QzlTZqniP37TUUIl52/preview', description: '用人單位提出增補人力需求時，詳述職缺條件與工作內容的申請單。', category: 'hr' },
        { id: 'form_hr_2', title: '2. 溝通單', date: '', url: 'https://docs.google.com/document/d/1jwIEgdwQvwUYsjSUlEqRkOC8e0WynBUA/preview', description: '公司內部跨部門或上下級間正式書面溝通的標準格式。', category: 'hr' },
        { id: 'form_hr_3', title: '3. 遵從報告', date: '', url: 'https://docs.google.com/document/d/1ZD-A5xPpkrGIEP6oxuKGnYkjJkqCbpoJ/preview', description: '員工確認已閱讀並理解公司新發布政策或規章的簽署報告。', category: 'hr' },
        { id: 'form_hr_4', title: '4. 示知報告', date: '', url: 'https://docs.google.com/document/d/11R39D2Bd_5UPdnJxbSw7CHunIdsUnDWu/preview', description: '主動回報工作進度、異常狀況或潛在問題的標準報告格式。', category: 'hr' },
        { id: 'form_hr_5', title: '5. CSW', date: '', url: 'https://docs.google.com/document/d/1yM4C22M7ErtO0hwMLC9Nl9cky6HiCwYa/preview', description: '完成職員工作(Completed Staff Work)的標準提案格式，供主管決策使用。', category: 'hr' },
        { id: 'form_hr_6', title: '6. 職務說明', date: '', url: 'https://docs.google.com/document/d/1DeQfGr3CFfz9IIdu_VDDXdfDaGavtcj3/preview', description: '詳細記錄特定職位的職責範圍、績效指標與所需技能的說明文件。', category: 'hr' },
        { id: 'form_hr_7', title: '7. 職務移轉兩週工作測試', date: '', url: 'https://docs.google.com/document/d/19_ufwOIANpPWNdFjg4h6NWRE11IZtJvI/preview', description: '評估職務交接或輪調人員在適應期內工作表現的測試紀錄表。', category: 'hr' },
        { id: 'form_hr_8', title: '8. 加速員30天挑戰賽任務清單', date: '', url: 'https://docs.google.com/document/d/1r5un0pHsIkkKPgGKTX_0MEXC97vpg2Q4/preview', description: '新進加速員在首月需完成的各項學習任務與挑戰目標檢核表。', category: 'hr' },
        { id: 'form_hr_9', title: '9. 主管推薦函(通過試用期)', date: '', url: 'https://docs.google.com/document/d/1RCtF8JUVlgAAnYyPdgM_wios_xmQcQph734hH_MMFrY/preview', description: '主管評估新進員工試用期表現，建議予以正式任用的推薦文件。', category: 'hr' },
        { id: 'form_hr_10', title: '10. 職員晉升-主管推薦函', date: '', url: 'https://docs.google.com/document/d/1kF5A-z1UIBtMTJQcgFuHtiA9NlsbX32a/preview', description: '主管提名優秀部屬晉升職等時填寫的績效舉證與推薦理由書。', category: 'hr' },
        { id: 'form_hr_11', title: '11. 職員晉升-自我推薦函', date: '', url: 'https://docs.google.com/document/d/1oYX__cOc5ycyhrfLwP7KSwmvIpL2O8nx/preview', description: '員工主動爭取晉升機會，闡述個人貢獻與未來展望的自薦信。', category: 'hr' },
        { id: 'form_hr_12', title: '12. 部門主管-終止契約訪談表', date: '', url: 'https://docs.google.com/document/d/1su7ELrkeOIRr7S9QxzYS3v8597yPQCO4/preview', description: '主管與離職員工進行最後訪談的紀錄表，用於了解離職原因與交接狀況。', category: 'hr' },
        { id: 'form_hr_13', title: '13. 離職移轉專案及職位清單', date: '', url: 'https://docs.google.com/document/d/1cj7yBzIk1qcUvU4OOX9BbtLE85vc2fFJ/preview', description: '詳細列出離職員工負責的待辦專案、資產與權限的移轉清單。', category: 'hr' },

        // --- 公關相關 (PR) ---
        { id: 'form_pr_1', title: '1. 活動紀錄素材需求表', date: '', url: 'https://docs.google.com/document/d/1pi3k1dCCAPDp-UzEy6wxnJXACH0Z8raU_aRrmxwNxu4/preview', description: '申請活動攝影、錄影或文案紀錄時，詳列需求細節的表格。', category: 'pr' },
        { id: 'form_pr_2', title: '2. 公關需求表', date: '', url: 'https://docs.google.com/document/d/1KLIjDbDxfOQljzTkPmpzD8Dh9vCBTDv9iQYzn8l39q4/preview', description: '各部門申請對外公關發布、媒體聯繫或品牌宣傳資源的需求單。', category: 'pr' },

        // --- 管理相關 (Mgmt) ---
        { id: 'form_mgmt_1', title: '1. 任命狀', date: '', url: 'https://docs.google.com/document/d/1uAj3EA2oU9mrsOFcWIbm2vzakTKt80rsxO1k2Jx5bkQ/preview', description: '正式發布人事任命、職務調動或晉升公告的標準文件格式。', category: 'mgmt' },

        // --- 穩盈相關 (Profit) ---
        { id: 'form_profit_1', title: '1. 顧問服務完成確認單', date: '', url: 'https://docs.google.com/document/d/1u3OXM2cAV829ZROE2y-wDK6s3X-V8PkL/preview', description: '顧問服務結束後，由客戶簽署確認服務內容已交付並滿意的單據。', category: 'profit' },
      ];

      // ==========================================
      // COMPONENTS (組件層)
      // ==========================================

      // 1. LoginGate (登入驗證)
      const LoginGate = ({ onAuthenticated }) => {
        const [password, setPassword] = useState('');
        const [error, setError] = useState(false);
        const [isFading, setIsFading] = useState(false);

        const handleLogin = (e) => {
          e.preventDefault();
          if (password === APP_CONFIG.PASSWORD) {
            // 改用 sessionStorage 並更換 Key 名稱，強制舊的 localStorage 失效
            sessionStorage.setItem('km_auth_session_v1', 'true');
            setIsFading(true);
            setTimeout(() => {
              onAuthenticated();
            }, 600); 
          } else {
            setError(true);
            setPassword('');
          }
        };

        return (
          <div className={`fixed inset-0 z-50 flex flex-col items-center justify-center bg-brand-gray text-white transition-opacity duration-700 ease-in-out ${isFading ? 'opacity-0 pointer-events-none' : 'opacity-100'}`}>
            <div className="w-full max-w-md p-8 bg-white/10 backdrop-blur-md rounded-2xl shadow-2xl border border-white/20 transform transition-all">
              <div className="flex flex-col items-center mb-8">
                <div className="p-4 bg-brand-green rounded-full mb-4 shadow-lg shadow-brand-green/30">
                  <ShieldCheck size={48} className="text-white" />
                </div>
                <h1 className="text-3xl font-bold tracking-wider mb-2">智匯中心</h1>
                <p className="text-gray-300 text-sm">Corporate Knowledge Management System</p>
              </div>
              <form onSubmit={handleLogin} className="space-y-6">
                <div className="relative">
                  <Lock className="absolute left-3 top-3.5 text-gray-400" size={20} />
                  <input
                    type="password"
                    value={password}
                    onChange={(e) => { setPassword(e.target.value); setError(false); }}
                    placeholder="請輸入訪問密碼"
                    className="w-full bg-white/90 text-brand-gray placeholder-gray-500 rounded-lg py-3 pl-10 pr-4 focus:outline-none focus:ring-4 focus:ring-brand-green/50 transition-all font-mono text-lg"
                    autoFocus
                  />
                </div>
                {error && <div className="text-red-400 text-sm text-center font-medium animate-pulse">密碼錯誤，請聯繫管理員索取。</div>}
                <button
                  type="submit"
                  className="w-full bg-brand-green hover:bg-[#1f8c3c] text-white font-bold py-3 rounded-lg shadow-lg flex items-center justify-center gap-2 transition-transform active:scale-95 group"
                >
                  <span>驗證身份</span>
                  <ArrowRight size={20} className="group-hover:translate-x-1 transition-transform" />
                </button>
              </form>
              <div className="mt-8 text-center">
                <p className="text-xs text-gray-400">
                  未經授權請勿嘗試訪問。<br />IP Address Logged for Security.
                </p>
              </div>
            </div>
          </div>
        );
      };

      // 2. Navbar (導覽列 + 清除搜尋按鈕)
      const Navbar = ({ scrollToSection, searchTerm, onSearch, onLogout }) => {
        const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);

        const navLinks = [
          { name: '規章制度', id: 'regulations' },
          { name: '粒子流程表', id: 'flowcharts' },
          { name: '共用表格', id: 'forms' },
        ];

        const handleNavClick = (id) => {
          scrollToSection(id);
          setIsMobileMenuOpen(false);
        };

        const clearSearch = () => {
          onSearch('');
        };

        return (
          <nav className="fixed top-0 left-0 right-0 bg-white/95 backdrop-blur-sm shadow-md z-40 border-b border-gray-100">
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
              <div className="flex justify-between items-center h-16 relative">
                {/* Logo */}
                <div 
                  className="flex-shrink-0 flex items-center gap-2 cursor-pointer z-10" 
                  onClick={() => window.scrollTo({top: 0, behavior: 'smooth'})} 
                >
                  <div className="w-8 h-8 bg-brand-green rounded-lg flex items-center justify-center">
                    <BookOpen className="text-white" size={20} />
                  </div>
                  <span className="font-bold text-xl text-brand-gray tracking-tight">
                    智匯中心<span className="hidden sm:inline">：企業規範導航</span>
                  </span>
                </div>
                {/* Desktop Menu */}
                <div className="hidden md:flex absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 items-center space-x-8">
                  {navLinks.map((link) => (
                    <button
                      key={link.id}
                      onClick={() => handleNavClick(link.id)}
                      className="text-brand-gray hover:text-brand-green font-medium transition-colors duration-200"
                    >
                      {link.name}
                    </button>
                  ))}
                </div>
                {/* Search & Logout */}
                <div className="hidden md:flex items-center gap-4 z-10">
                  <div className="relative group">
                    <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 group-focus-within:text-brand-green transition-colors" size={18} />
                    <input
                      type="text"
                      value={searchTerm}
                      onChange={(e) => onSearch(e.target.value)}
                      placeholder="搜尋..."
                      className="pl-10 pr-10 py-2 bg-gray-50 border border-gray-200 rounded-full text-sm focus:outline-none focus:border-brand-green focus:ring-1 focus:ring-brand-green w-48 transition-all focus:w-64"
                    />
                    {searchTerm && (
                      <button
                        onClick={clearSearch}
                        className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 focus:outline-none p-0.5 rounded-full hover:bg-gray-100 transition-colors"
                        title="清除搜尋"
                      >
                        <X size={14} />
                      </button>
                    )}
                  </div>
                  <div className="h-6 w-px bg-gray-200 mx-1"></div>
                  <button
                    onClick={onLogout}
                    className="flex items-center gap-1 text-gray-400 hover:text-brand-gray transition-colors"
                    title="登出系統"
                  >
                    <LogOut size={20} />
                    <span className="text-sm font-medium">登出</span>
                  </button>
                </div>
                {/* Mobile Menu Button */}
                <div className="md:hidden flex items-center">
                  <button
                    onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}
                    className="text-brand-gray hover:text-brand-green focus:outline-none p-2"
                  >
                    {isMobileMenuOpen ? <X size={28} /> : <Menu size={28} />}
                  </button>
                </div>
              </div>
            </div>
            {/* Mobile Dropdown */}
            <div className={`md:hidden overflow-hidden transition-all duration-300 ease-in-out ${isMobileMenuOpen ? 'max-h-80 opacity-100' : 'max-h-0 opacity-0'}`}>
              <div className="px-4 pt-2 pb-4 space-y-2 bg-white border-t border-gray-100 shadow-lg">
                <div className="mb-4 relative">
                  <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" size={18} />
                  <input
                    type="text"
                    value={searchTerm}
                    onChange={(e) => onSearch(e.target.value)}
                    placeholder="搜尋網站內容..."
                    className="w-full pl-10 pr-10 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:outline-none focus:border-brand-green focus:ring-1 focus:ring-brand-green"
                  />
                  {searchTerm && (
                    <button
                      onClick={clearSearch}
                      className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 focus:outline-none p-1 rounded-full hover:bg-gray-100 transition-colors"
                    >
                      <X size={16} />
                    </button>
                  )}
                </div>
                {navLinks.map((link) => (
                  <button
                    key={link.id}
                    onClick={() => handleNavClick(link.id)}
                    className="block w-full text-left px-3 py-3 rounded-md text-base font-medium text-brand-gray hover:bg-green-50 hover:text-brand-green transition-colors"
                  >
                    {link.name}
                  </button>
                ))}
                <div className="border-t border-gray-100 my-2"></div>
                <button
                  onClick={() => { onLogout(); setIsMobileMenuOpen(false); }}
                  className="block w-full text-left px-3 py-3 rounded-md text-base font-medium text-red-500 hover:bg-red-50 transition-colors flex items-center gap-2"
                >
                  <LogOut size={18} />
                  登出系統
                </button>
              </div>
            </div>
          </nav>
        );
      };

      // 3. SectionRegulations (規章制度 - 含日期顯示)
      const SectionRegulations = ({ data, onItemClick, searchTerm }) => {
        const [selectedCategoryId, setSelectedCategoryId] = useState(null);

        useEffect(() => {
          if (searchTerm) setSelectedCategoryId(null);
        }, [searchTerm]);

        const handleCategoryClick = (id) => {
          setSelectedCategoryId(id);
          if (id) {
            const element = document.getElementById('regulations');
            if(element) {
              const yOffset = -80; 
              const y = element.getBoundingClientRect().top + window.pageYOffset + yOffset;
              window.scrollTo({ top: y, behavior: 'smooth' });
            }
          }
        };

        const isSearching = searchTerm.length > 0;
        const isCategorySelected = selectedCategoryId !== null;
        
        const displayData = isSearching 
          ? data 
          : (selectedCategoryId ? data.filter(item => item.category === selectedCategoryId) : []);

        return (
          <div className="bg-white rounded-xl shadow-sm border border-gray-100 overflow-visible min-h-[300px] relative z-30 transition-all duration-300 hover:shadow-md hover:border-brand-green/30">
            {/* Sticky Header */}
            <div className="sticky top-16 z-40 p-5 border-b border-gray-100 flex flex-col justify-center bg-white/95 backdrop-blur-md rounded-t-xl transition-all shadow-sm">
              <div className="flex items-center gap-3 mb-2">
                <div className="bg-green-100 p-2 rounded-lg text-brand-green"> <FileText size={24} /> </div>
                <h2 className="text-2xl font-bold text-brand-gray flex items-center gap-2">
                  規章制度 <span className="text-sm font-normal text-gray-400 ml-1 hidden sm:inline">Regulations</span>
                </h2>
              </div>
              {!isSearching && (
                <div className="flex gap-2 overflow-x-auto scrollbar-hide pb-2 mt-2 w-full">
                  <button
                    onClick={() => handleCategoryClick(null)}
                    className={`whitespace-nowrap px-3 py-1 rounded-full text-sm font-medium border transition-colors ${selectedCategoryId === null ? 'bg-brand-green text-white border-brand-green' : 'bg-white text-gray-500 border-gray-200 hover:border-brand-green hover:text-brand-green'}`}
                  >所有分類</button>
                  {REGULATION_CATEGORIES.map(cat => (
                    <button
                      key={cat.id}
                      onClick={() => handleCategoryClick(cat.id)}
                      className={`whitespace-nowrap px-3 py-1 rounded-full text-sm font-medium border transition-colors ${selectedCategoryId === cat.id ? 'bg-brand-green text-white border-brand-green' : 'bg-white text-gray-500 border-gray-200 hover:border-brand-green hover:text-brand-green'}`}
                    >{cat.name}</button>
                  ))}
                </div>
              )}
            </div>
            {/* Content */}
            <div className="p-6">
              {!isSearching && !isCategorySelected && (
                <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 animate-in fade-in slide-in-from-bottom-4 duration-500">
                  {REGULATION_CATEGORIES.map((cat) => (
                    <button
                      key={cat.id}
                      onClick={() => handleCategoryClick(cat.id)}
                      className="flex flex-col items-center justify-center p-6 border border-gray-100 rounded-xl hover:border-brand-green hover:shadow-lg hover:shadow-brand-green/10 hover:-translate-y-1 transition-all duration-300 group bg-white h-40"
                    >
                      <div className="bg-gray-50 p-4 rounded-full mb-3 group-hover:bg-brand-green transition-colors duration-300">
                        <Folder size={32} className="text-gray-400 group-hover:text-white transition-colors duration-300" />
                      </div>
                      <span className="font-bold text-gray-600 group-hover:text-brand-green transition-colors">{cat.name}</span>
                    </button>
                  ))}
                </div>
              )}
              {(isSearching || isCategorySelected) && (
                <div className="space-y-4 animate-in fade-in slide-in-from-bottom-2 duration-300">
                  {displayData.length === 0 ? (
                    <div className="flex flex-col items-center justify-center text-center py-12 opacity-60">
                      <div className="bg-gray-50 p-4 rounded-full mb-3"> <MousePointerClick size={32} className="text-gray-300" /> </div>
                      <p className="text-gray-400">此分類暫無文件</p>
                      {isCategorySelected && <button onClick={() => handleCategoryClick(null)} className="mt-4 text-brand-green hover:underline">返回分類列表</button>}
                    </div>
                  ) : (
                    <div className="grid gap-3">
                      {displayData.map((item) => (
                        <div
                          key={item.id}
                          onClick={() => onItemClick(item)}
                          className="p-5 border border-gray-100 rounded-lg hover:bg-green-50/30 hover:border-brand-green/30 transition-all group cursor-pointer bg-white shadow-sm hover:shadow-md"
                        >
                          <div className="flex justify-between items-start">
                            <div className="flex-1">
                              <div className="flex items-center gap-2 mb-2">
                                <FolderOpen size={16} className="text-brand-green/70" />
                                <h3 className="text-lg font-bold text-brand-gray group-hover:text-brand-green transition-colors">{item.title}</h3>
                              </div>
                              <p className="text-sm text-gray-500 leading-relaxed pl-6 border-l-2 border-gray-100 group-hover:border-brand-green/30 transition-colors">{item.description}</p>
                            </div>
                            {/* 更新日期顯示欄位 - 顯示在右側 */}
                            <div className="flex flex-col items-end gap-1 min-w-[80px]">
                              <span className="text-gray-400 text-xs font-mono tracking-wider">{item.date}</span>
                              <div className="flex items-center gap-2">
                                {item.isNew && <span className="bg-red-100 text-red-600 text-xs font-bold px-2 py-1 rounded-full shrink-0">NEW</span>}
                                <ChevronRight size={20} className="text-gray-300 group-hover:text-brand-green group-hover:translate-x-1 transition-all mt-1" />
                              </div>
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              )}
            </div>
          </div>
        );
      };

      // 4. SectionFlowcharts
      const SectionFlowcharts = ({ data, onItemClick, searchTerm }) => {
        const [selectedCategoryId, setSelectedCategoryId] = useState(null);

        useEffect(() => { if (searchTerm) setSelectedCategoryId(null); }, [searchTerm]);

        const handleCategoryClick = (id) => {
          setSelectedCategoryId(id);
          if (id) {
            const element = document.getElementById('flowcharts');
            if(element) {
              const yOffset = -80; 
              const y = element.getBoundingClientRect().top + window.pageYOffset + yOffset;
              window.scrollTo({ top: y, behavior: 'smooth' });
            }
          }
        };

        const isSearching = searchTerm.length > 0;
        const isCategorySelected = selectedCategoryId !== null;
        const displayData = isSearching ? data : (selectedCategoryId ? data.filter(item => item.category === selectedCategoryId) : []);

        return (
          <div className="bg-white rounded-xl shadow-sm border border-gray-100 overflow-visible min-h-[300px] relative z-20 transition-all duration-300 hover:shadow-md hover:border-brand-green/30">
            <div className="sticky top-16 z-40 p-5 border-b border-gray-100 flex flex-col justify-center bg-white/95 backdrop-blur-md rounded-t-xl transition-all shadow-sm">
              <div className="flex items-center gap-3 mb-2">
                <div className="bg-green-100 p-2 rounded-lg text-brand-green"> <Activity size={24} /> </div>
                <h2 className="text-2xl font-bold text-brand-gray flex items-center gap-2">
                  粒子流程表 <span className="text-sm font-normal text-gray-400 ml-1 hidden sm:inline">Workflows</span>
                </h2>
              </div>
              {!isSearching && (
                <div className="flex gap-2 overflow-x-auto scrollbar-hide pb-2 mt-2 w-full">
                  <button onClick={() => handleCategoryClick(null)} className={`whitespace-nowrap px-3 py-1 rounded-full text-sm font-medium border transition-colors ${selectedCategoryId === null ? 'bg-brand-green text-white border-brand-green' : 'bg-white text-gray-500 border-gray-200 hover:border-brand-green hover:text-brand-green'}`}>所有部門</button>
                  {FLOWCHART_CATEGORIES.map(cat => (
                    <button key={cat.id} onClick={() => handleCategoryClick(cat.id)} className={`whitespace-nowrap px-3 py-1 rounded-full text-sm font-medium border transition-colors ${selectedCategoryId === cat.id ? 'bg-brand-green text-white border-brand-green' : 'bg-white text-gray-500 border-gray-200 hover:border-brand-green hover:text-brand-green'}`}>{cat.name}</button>
                  ))}
                </div>
              )}
            </div>
            <div className="p-6">
              {!isSearching && !isCategorySelected && (
                <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 animate-in fade-in slide-in-from-bottom-4 duration-500">
                  {FLOWCHART_CATEGORIES.map((cat) => (
                    <button key={cat.id} onClick={() => handleCategoryClick(cat.id)} className="flex flex-col items-center justify-center p-6 border border-gray-100 rounded-xl hover:border-brand-green hover:shadow-lg hover:shadow-brand-green/10 hover:-translate-y-1 transition-all duration-300 group bg-white h-40">
                      <div className="bg-gray-50 p-4 rounded-full mb-3 group-hover:bg-brand-green transition-colors duration-300">
                        <Share2 size={32} className="text-gray-400 group-hover:text-white transition-colors duration-300" />
                      </div>
                      <span className="font-bold text-gray-600 group-hover:text-brand-green transition-colors">{cat.name}</span>
                    </button>
                  ))}
                </div>
              )}
              {(isSearching || isCategorySelected) && (
                <div className="space-y-4 animate-in fade-in slide-in-from-bottom-2 duration-300">
                   {displayData.length === 0 ? (
                    <div className="flex flex-col items-center justify-center text-center py-12 opacity-60">
                      <div className="bg-gray-50 p-4 rounded-full mb-3"> <MousePointerClick size={32} className="text-gray-300" /> </div>
                      <p className="text-gray-400">此部門暫無流程文件</p>
                      {isCategorySelected && <button onClick={() => handleCategoryClick(null)} className="mt-4 text-brand-green hover:underline">返回部門列表</button>}
                    </div>
                  ) : (
                    <div className="grid gap-3">
                      {displayData.map((item) => (
                        <div key={item.id} onClick={() => onItemClick(item)} className="p-5 border border-gray-100 rounded-lg hover:bg-green-50/30 hover:border-brand-green/30 transition-all group cursor-pointer bg-white shadow-sm hover:shadow-md">
                          <div className="flex justify-between items-start">
                            <div className="flex-1">
                              <div className="flex items-center gap-2 mb-2">
                                 <GitMerge size={16} className="text-brand-green/70" />
                                 <h3 className="text-lg font-bold text-brand-gray group-hover:text-brand-green transition-colors">{item.title}</h3>
                              </div>
                              <p className="text-sm text-gray-500 leading-relaxed pl-6 border-l-2 border-gray-100 group-hover:border-brand-green/30 transition-colors">{item.description}</p>
                            </div>
                            <div className="flex flex-col items-end gap-1 min-w-[80px]">
                              <span className="text-gray-400 text-xs font-mono tracking-wider">{item.date}</span>
                              <ChevronRight size={20} className="text-gray-300 group-hover:text-brand-green group-hover:translate-x-1 transition-all mt-1" />
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              )}
            </div>
          </div>
        );
      };

      // 5. SectionForms (共用表格 - 移除日期顯示)
      const SectionForms = ({ data, onItemClick, searchTerm }) => {
        const [selectedCategoryId, setSelectedCategoryId] = useState(null);

        useEffect(() => { if (searchTerm) setSelectedCategoryId(null); }, [searchTerm]);

        const handleCategoryClick = (id) => {
          setSelectedCategoryId(id);
          if (id) {
            const element = document.getElementById('forms');
            if(element) {
              const yOffset = -80; 
              const y = element.getBoundingClientRect().top + window.pageYOffset + yOffset;
              window.scrollTo({ top: y, behavior: 'smooth' });
            }
          }
        };

        const isSearching = searchTerm.length > 0;
        const isCategorySelected = selectedCategoryId !== null;
        const displayData = isSearching ? data : (selectedCategoryId ? data.filter(item => item.category === selectedCategoryId) : []);

        return (
          <div className="bg-white rounded-xl shadow-sm border border-gray-100 overflow-visible min-h-[300px] relative z-10 transition-all duration-300 hover:shadow-md hover:border-brand-green/30">
            <div className="sticky top-16 z-40 p-5 border-b border-gray-100 flex flex-col justify-center bg-white/95 backdrop-blur-md rounded-t-xl transition-all shadow-sm">
               <div className="flex items-center gap-3 mb-2">
                  <div className="bg-green-100 p-2 rounded-lg text-brand-green"> <Table size={24} /> </div>
                  <h2 className="text-2xl font-bold text-brand-gray flex items-center gap-2">
                    共用表格 <span className="text-sm font-normal text-gray-400 ml-1 hidden sm:inline">Shared Forms</span>
                  </h2>
               </div>
               {!isSearching && (
                 <div className="flex gap-2 overflow-x-auto scrollbar-hide pb-2 mt-2 w-full">
                   <button onClick={() => handleCategoryClick(null)} className={`whitespace-nowrap px-3 py-1 rounded-full text-sm font-medium border transition-colors ${selectedCategoryId === null ? 'bg-brand-green text-white border-brand-green' : 'bg-white text-gray-500 border-gray-200 hover:border-brand-green hover:text-brand-green'}`}>所有表格</button>
                   {FORM_CATEGORIES.map(cat => (
                     <button key={cat.id} onClick={() => handleCategoryClick(cat.id)} className={`whitespace-nowrap px-3 py-1 rounded-full text-sm font-medium border transition-colors ${selectedCategoryId === cat.id ? 'bg-brand-green text-white border-brand-green' : 'bg-white text-gray-500 border-gray-200 hover:border-brand-green hover:text-brand-green'}`}>{cat.name}</button>
                   ))}
                 </div>
              )}
            </div>
            <div className="p-6">
              {!isSearching && !isCategorySelected && (
                <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 animate-in fade-in slide-in-from-bottom-4 duration-500">
                  {FORM_CATEGORIES.map((cat) => (
                    <button key={cat.id} onClick={() => handleCategoryClick(cat.id)} className="flex flex-col items-center justify-center p-6 border border-gray-100 rounded-xl hover:border-brand-green hover:shadow-lg hover:shadow-brand-green/10 hover:-translate-y-1 transition-all duration-300 group bg-white h-40">
                       <div className="bg-gray-50 p-4 rounded-full mb-3 group-hover:bg-brand-green transition-colors duration-300">
                        <Layers size={32} className="text-gray-400 group-hover:text-white transition-colors duration-300" />
                      </div>
                      <span className="font-bold text-gray-600 group-hover:text-brand-green transition-colors">{cat.name}</span>
                    </button>
                  ))}
                </div>
              )}
              {(isSearching || isCategorySelected) && (
                <div className="space-y-4 animate-in fade-in slide-in-from-bottom-2 duration-300">
                  {displayData.length === 0 ? (
                    <div className="flex flex-col items-center justify-center text-center py-12 opacity-60">
                      <div className="bg-gray-50 p-4 rounded-full mb-3"> <MousePointerClick size={32} className="text-gray-300" /> </div>
                      <p className="text-gray-400">此分類暫無表格</p>
                      {isCategorySelected && <button onClick={() => handleCategoryClick(null)} className="mt-4 text-brand-green hover:underline">返回表格列表</button>}
                    </div>
                  ) : (
                    <div className="grid gap-3">
                      {displayData.map((item) => (
                        <div key={item.id} onClick={() => onItemClick(item)} className="p-5 border border-gray-100 rounded-lg hover:bg-green-50/30 hover:border-brand-green/30 transition-all group cursor-pointer bg-white shadow-sm hover:shadow-md">
                          <div className="flex justify-between items-start">
                            <div className="flex-1">
                              <div className="flex items-center gap-2 mb-2">
                                 <Archive size={16} className="text-brand-green/70" />
                                 <h3 className="text-lg font-bold text-brand-gray group-hover:text-brand-green transition-colors">{item.title}</h3>
                              </div>
                              <p className="text-sm text-gray-500 leading-relaxed pl-6 border-l-2 border-gray-100 group-hover:border-brand-green/30 transition-colors">{item.description}</p>
                            </div>
                            {/* 移除日期顯示 */}
                            <div className="flex flex-col items-end gap-1 min-w-[24px]">
                              <ChevronRight size={20} className="text-gray-300 group-hover:text-brand-green group-hover:translate-x-1 transition-all mt-1" />
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              )}
            </div>
          </div>
        );
      };

      // 6. DocPreviewModal
      const DocPreviewModal = ({ isOpen, onClose, title, url }) => {
        if (!isOpen) return null;

        const getDownloadUrl = (docUrl, format) => {
          try {
            const match = docUrl.match(/\/d\/([a-zA-Z0-9-_]+)/);
            if (match && match[1]) {
              return `https://docs.google.com/document/d/${match[1]}/export?format=${format}`;
            }
          } catch (e) { console.error("URL 解析錯誤", e); }
          return docUrl;
        };

        const pdfUrl = getDownloadUrl(url, 'pdf');
        const wordUrl = getDownloadUrl(url, 'docx');

        return (
          <div className="fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6">
            <div className="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity modal-overlay" onClick={onClose}></div>
            <div className="relative w-full max-w-5xl h-[85vh] bg-white rounded-2xl shadow-2xl flex flex-col overflow-hidden animate-in fade-in zoom-in-95 duration-300 modal-container">
              {/* Header */}
              <div className="flex items-center justify-between px-6 py-4 border-b border-gray-100 bg-gray-50/50 modal-header">
                <h3 className="text-lg font-bold text-brand-gray truncate pr-4">{title}</h3>
                <button onClick={onClose} className="p-2 hover:bg-gray-200 rounded-full transition-colors text-gray-500">
                  <X size={24} />
                </button>
              </div>
              {/* Iframe */}
              <div className="flex-1 bg-gray-100 relative modal-iframe-container">
                <iframe src={url} title={title} className="w-full h-full border-0" allow="autoplay"></iframe>
              </div>
              {/* Footer */}
              <div className="px-6 py-4 border-t border-gray-100 bg-white flex flex-col sm:flex-row justify-end gap-3 modal-footer">
                <a href={wordUrl} target="_blank" rel="noopener noreferrer" className="flex items-center justify-center gap-2 bg-white border border-blue-200 text-blue-700 hover:bg-blue-50 px-5 py-2.5 rounded-lg font-medium transition-colors" title="下載為 Word 檔案">
                  <FileText size={18} /> <span>下載 Word</span>
                </a>
                <a href={pdfUrl} target="_blank" rel="noopener noreferrer" className="flex items-center justify-center gap-2 bg-white border border-gray-200 text-gray-700 hover:bg-gray-50 hover:text-brand-gray px-5 py-2.5 rounded-lg font-medium transition-colors" title="下載為 PDF 檔案">
                  <Download size={18} /> <span>下載 PDF</span>
                </a>
                <a href={url} target="_blank" rel="noopener noreferrer" className="flex items-center justify-center gap-2 bg-brand-green hover:bg-[#1f8c3c] text-white px-5 py-2.5 rounded-lg font-medium transition-transform active:scale-95 shadow-md shadow-brand-green/20">
                  <ExternalLink size={18} /> <span>線上閱讀</span>
                </a>
              </div>
            </div>
          </div>
        );
      };

      // 7. App (Main)
      const App = () => {
        const [isAuthenticated, setIsAuthenticated] = useState(false);
        const [isLoading, setIsLoading] = useState(true);
        const [searchTerm, setSearchTerm] = useState('');
        const [isModalOpen, setIsModalOpen] = useState(false);
        const [currentDoc, setCurrentDoc] = useState(null);

        useEffect(() => {
          // 改用 sessionStorage 並更換 Key，確保使用者重整後保持登入，但關閉瀏覽器後需重登
          // 且因為 Key 名稱變更為 km_auth_session_v1，舊的 localStorage 紀錄將被忽略
          const storedAuth = sessionStorage.getItem('km_auth_session_v1');
          if (storedAuth === 'true') setIsAuthenticated(true);
          setTimeout(() => setIsLoading(false), 500);
        }, []);

        const handleAuthenticated = () => setIsAuthenticated(true);
        const handleLogout = () => {
          // 清除新的 sessionStorage Key
          sessionStorage.removeItem('km_auth_session_v1');
          setIsAuthenticated(false);
          setSearchTerm('');
          window.scrollTo({ top: 0, behavior: 'auto' });
        };

        const scrollToSection = (id) => {
          const element = document.getElementById(id);
          if (element) {
            const yOffset = -80; 
            const y = element.getBoundingClientRect().top + window.pageYOffset + yOffset;
            window.scrollTo({ top: y, behavior: 'smooth' });
          }
        };

        const handleDocClick = (item) => {
          setCurrentDoc({ title: item.title, url: item.url });
          setIsModalOpen(true);
        };

        const filteredRegulations = REGULATIONS_DATA.filter(item => item.title.toLowerCase().includes(searchTerm.toLowerCase()));
        const filteredFlowcharts = FLOWCHARTS_DATA.filter(item => item.title.toLowerCase().includes(searchTerm.toLowerCase()));
        const filteredForms = FORMS_DATA.filter(item => item.title.toLowerCase().includes(searchTerm.toLowerCase()));

        const hasSearch = searchTerm.length > 0;
        const showRegulations = !hasSearch || filteredRegulations.length > 0;
        const showFlowcharts = !hasSearch || filteredFlowcharts.length > 0;
        const showForms = !hasSearch || filteredForms.length > 0;
        const noResults = hasSearch && !showRegulations && !showFlowcharts && !showForms;

        if (isLoading) return null;

        return (
          <div className="min-h-screen relative font-sans">
            {!isAuthenticated && <LoginGate onAuthenticated={handleAuthenticated} />}
            {currentDoc && (
              <DocPreviewModal 
                isOpen={isModalOpen} 
                onClose={() => setIsModalOpen(false)} 
                title={currentDoc.title} 
                url={currentDoc.url} 
              />
            )}
            <div className={`transition-opacity duration-1000 ${isAuthenticated ? 'opacity-100' : 'opacity-0'}`}>
              {isAuthenticated && (
                <React.Fragment>
                  <Navbar scrollToSection={scrollToSection} searchTerm={searchTerm} onSearch={setSearchTerm} onLogout={handleLogout} />
                  <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-24 pb-32 space-y-16">
                    <div className="bg-gradient-to-r from-brand-gray to-gray-700 rounded-2xl p-8 md:p-12 text-white shadow-xl">
                      <h1 className="text-3xl md:text-4xl font-bold mb-4">歡迎回到智匯中心</h1>
                      <p className="text-gray-200 text-lg max-w-2xl">
                        在此查找最新的規章制度、粒子流程表以及共用表格。<br className="hidden md:block"/>致力於打造透明、高效的資訊共享環境。
                      </p>
                    </div>
                    {searchTerm && <div className="text-gray-500 text-sm">搜尋結果：包含 "{searchTerm}" 的資料</div>}
                    {noResults && (
                      <div className="text-center py-20 text-gray-400 bg-gray-50 rounded-xl border border-dashed border-gray-200">
                        <p className="text-xl font-medium mb-2">找不到符合的資料</p>
                        <p className="text-sm">請嘗試其他關鍵字</p>
                      </div>
                    )}
                    {showRegulations && <section id="regulations"><SectionRegulations data={filteredRegulations} onItemClick={handleDocClick} searchTerm={searchTerm} /></section>}
                    {showFlowcharts && <section id="flowcharts"><SectionFlowcharts data={filteredFlowcharts} onItemClick={handleDocClick} searchTerm={searchTerm} /></section>}
                    {showForms && <section id="forms"><SectionForms data={filteredForms} onItemClick={handleDocClick} searchTerm={searchTerm} /></section>}
                  </main>
                  <footer className="bg-white border-t border-gray-100 py-10">
                    <div className="max-w-7xl mx-auto px-4 text-center text-gray-400 text-sm">
                      <p>©2026本網頁內容僅限員工內部參考。嚴禁截圖、轉發或以任何形式帶離公司，違者必究。</p>
                    </div>
                  </footer>
                </React.Fragment>
              )}
            </div>
          </div>
        );
      };

      const root = createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>