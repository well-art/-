<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>企業知識管理門戶 | KM Portal</title>
    <!-- 引入 Noto Sans TC 繁體中文字體 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Babel Standalone (用於在瀏覽器中解析 JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind 配置 -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              brand: {
                green: '#24a145', // 企業綠 (主色調)
                gray: '#595656',  // 灰度空間 (文字/背景)
              }
            },
            fontFamily: {
              sans: ['"Noto Sans TC"', 'sans-serif'],
            }
          }
        }
      }
    </script>
    <style>
      body {
        font-family: 'Noto Sans TC', sans-serif;
      }
      /* 隱藏滾動條但保留功能 */
      .scrollbar-hide::-webkit-scrollbar {
          display: none;
      }
      .scrollbar-hide {
          -ms-overflow-style: none;
          scrollbar-width: none;
      }
      /* 淡入動畫 */
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .animate-in {
        animation: fadeIn 0.5s ease-out forwards;
      }

      /* 列印樣式設定 */
      @media print {
        /* 隱藏所有非相關元素 */
        body > * { display: none !important; }
        #root { display: none !important; }
        
        /* 針對 Modal 進行強制顯示與全螢幕設定 */
        .modal-container {
          display: block !important;
          position: fixed !important;
          top: 0 !important;
          left: 0 !important;
          width: 100% !important;
          height: 100% !important;
          max-width: 100% !important;
          margin: 0 !important;
          padding: 0 !important;
          box-shadow: none !important;
          z-index: 99999 !important;
          background: white !important;
          border-radius: 0 !important;
        }
        
        /* 隱藏 Modal 的標題列與底部按鈕列 */
        .modal-header, .modal-footer, .modal-overlay {
          display: none !important;
        }
        
        /* 讓 iframe 佔滿整個列印頁面 */
        .modal-iframe-container {
          height: 100% !important;
          width: 100% !important;
        }
        iframe {
          height: 100vh !important;
          width: 100vw !important;
          border: none !important;
        }
      }
    </style>
  <script type="importmap">
{
  "imports": {
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/",
    "react": "https://esm.sh/react@^19.2.3",
    "lucide-react": "https://esm.sh/lucide-react@^0.562.0"
  }
}
</script>
</head>
  <body class="bg-gray-50 text-brand-gray antialiased">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
      import React, { useState, useEffect } from 'https://esm.sh/react@18.3.1';
      import { createRoot } from 'https://esm.sh/react-dom@18.3.1/client';
      import { 
        Menu, X, BookOpen, Search, LogOut, 
        Lock, ArrowRight, ShieldCheck, 
        FileText, ChevronRight, ArrowLeft, Folder, FolderOpen, MousePointerClick,
        Activity, GitMerge, Share2,
        Table, Archive, Layers, Download, ExternalLink, HelpCircle, Printer
      } from 'https://esm.sh/lucide-react@0.344.0';

      // ==========================================
      // CONSTANTS & DATA (資料層)
      // ==========================================
      const APP_CONFIG = {
        PASSWORD: '2693988',
        COLORS: {
          PRIMARY: '#24a145',
          SECONDARY: '#595656',
        },
        CONTACT_EMAIL: 'admin@company.com',
      };

      const REGULATION_CATEGORIES = [
        { id: 'org', name: '組織系列' },
        { id: 'tech', name: '技術系列' },
        { id: 'finance', name: '財務系列' },
        { id: 'marketing', name: '行銷系列' },
        { id: 'integrity', name: '品格系列' },
      ];

      const FLOWCHART_CATEGORIES = [
        { id: 'dept1', name: '一部門' },
        { id: 'dept2', name: '二部門' },
        { id: 'dept3', name: '三部門' },
        { id: 'dept4', name: '四部門' },
        { id: 'dept5', name: '五部門' },
        { id: 'dept6', name: '六部門' },
        { id: 'dept7', name: '七部門' },
      ];

      const FORM_CATEGORIES = [
        { id: 'docs', name: '文書檔案' },
        { id: 'seals', name: '印鑑相關' },
        { id: 'finance_form', name: '財務相關' },
        { id: 'hr', name: '人事相關' },
        { id: 'pr', name: '公關相關' },
        { id: 'mgmt', name: '管理相關' },
        { id: 'profit', name: '穩盈相關' },
      ];

      // 真實資料 - 完整版
      const REGULATIONS_DATA = [
        // --- 組織系列 (Organization) ---
        { 
          id: 'reg_org_0', 
          title: '0. 工作規則', 
          date: '2024-05-20', 
          url: 'https://drive.google.com/file/d/162Ypn3-kp7ENhSdJ2KByYrH3zWxyPCdl/preview',
          description: '規範勞資雙方權利義務，包含工時、休假、獎懲與福利等重要從業準則。',
          category: 'org',
          isNew: true 
        },
        { 
          id: 'reg_org_1', 
          title: '1. 目標與目的規章', 
          date: '2024-05-20', 
          url: 'https://docs.google.com/document/d/1eTqS3bMABIexMjFmjighRF-932K-iwYtxGCuxTqi7SA/preview',
          description: '明確定義公司的短期目標與長期願景，確保全員方向一致，聚焦核心價值。',
          category: 'org'
        },
        { 
          id: 'reg_org_2', 
          title: '2. 公司歷史規章', 
          date: '2024-05-20', 
          url: 'https://docs.google.com/document/d/1sqckdA0LorOmgAPLTPVcd5IX9glpY6JrCnDpLE011BU/preview',
          description: '記錄公司發展歷程、重要里程碑與企業文化演變，傳承企業精神。',
          category: 'org'
        },
        { 
          id: 'reg_org_3', 
          title: '3. 最終有價值產品規章', 
          date: '2024-05-20', 
          url: 'https://docs.google.com/document/d/1LkRpu50VcovwOldcXcVf62ZjN-Vc0ghpha82SM2XSx8/preview',
          description: '定義公司各職位最終應交付的有價值產品(VFVP)之標準與品質要求。',
          category: 'org'
        },
        { 
          id: 'reg_org_4', 
          title: '4. 組織圖使用規章', 
          date: '2024-05-20', 
          url: 'https://docs.google.com/document/d/1Uo1MSRM_Wk60sPmbzSRisHozcB5aEYn6y0C3sE4XmdY/preview',
          description: '闡述組織架構圖之閱讀方式、職權指揮鏈與部門功能劃分原則。',
          category: 'org'
        },
        {
          id: 'reg_org_5',
          title: '5. 各課的職責',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1ku0Ej2LLShAs8LZzGINfrTEOmOVT2U422_cU4DoYAsQ/preview',
          description: '詳細列出各課級單位的職掌範圍、工作重點與責任歸屬。',
          category: 'org'
        },
        {
          id: 'reg_org_6',
          title: '6. 每週職員會議規章',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1ohWmuWllovNUWZ-n_q9jOXY2-cUC-ACAUQJ8sEyCXZQ/preview',
          description: '規範每週例會的進行流程、報告事項與決議追蹤機制。',
          category: 'org'
        },
        {
          id: 'reg_org_7',
          title: '7. 書面溝通規章',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1iaUQH5ld4MwWAbUg7Cnaw9EXpm6yCSTqj-T9XUUzpX0/preview',
          description: '定義內部文書往來的格式、傳遞路徑與簽核權限，確保資訊準確傳達。',
          category: 'org'
        },
        {
          id: 'reg_org_8',
          title: '8. 命令規章',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1Tc1y9xmOER4fa6lJ0JR5YHlGpYI13RDrb585Xi4Mg5w/preview',
          description: '闡述上級下達命令的標準程序與部屬接收指令後的執行回報準則。',
          category: 'org'
        },
        {
          id: 'reg_org_9',
          title: '9. CSW規章',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1lU7gyS4a1zoKhOJA4_WUqelVHQ0pr2fiFUdxGPuLrI8/preview',
          description: '完成職員工作（Completed Staff Work）的標準定義與交付品質要求。',
          category: 'org'
        },
        {
          id: 'reg_org_10',
          title: '10. 工作資料夾規章',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1LL5FQQwiqjJf8MaXXUwUPBhqEmDSmhfKm95CcyEpDPI/preview',
          description: '規範個人工作資料的分類、歸檔與維護方式，確保知識資產保存。',
          category: 'org'
        },
        {
          id: 'reg_org_11',
          title: '11. 工作資料夾檢視規章',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1Z-A26U00KEfRUfp2pGWUmHVkU1N_lElXT3yCT790jZw/preview',
          description: '主管定期檢視部屬工作資料夾的標準流程與評核重點。',
          category: 'org'
        },
        {
          id: 'reg_org_12',
          title: '12. 如何撰寫規章的規章',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1c3sAQv1uzgKfm3w3jPlLBdlzXlOfv3SIBVPxLRursIo/preview',
          description: '制定公司內部規章文件的標準格式、撰寫風格與發布流程。',
          category: 'org'
        },
        {
          id: 'reg_org_13',
          title: '13. 統計曲線規章',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1qNhw6b_9OM3q-HSjuZbNsK6svpiwFMRRyd0TGsNTfEU/preview',
          description: '說明如何繪製與解讀績效統計曲線，以數據輔助管理決策。',
          category: 'org'
        },
        {
          id: 'reg_org_14',
          title: '14. 職員出勤規章',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/17wdy8YJ-IeBDUjsmLi0pSYYF572BPvH3_WRaHUL3ctM/preview',
          description: '詳細規定上下班打卡、遲到早退、加班與休假申請之管理辦法。',
          category: 'org'
        },
        {
          id: 'reg_org_15',
          title: '15. 如何修改公司管理工具規章',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1nzs_RmDkEtFRlzozNbHthElDOJTH1H9ulqD33Gtj54g/preview',
          description: '定義內部管理系統與工具的變更申請、測試與上線流程。',
          category: 'org'
        },
        {
          id: 'reg_org_16',
          title: '16. 辦公室用品操作與管理規章',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1INOPF34RMO_gUh5gegOBNSwK101r9Z78e17Er8E7T9Y/preview',
          description: '規範辦公設備與耗材的領用、維護及盤點管理規則。',
          category: 'org'
        },
        {
          id: 'reg_org_17',
          title: '17. 印鑑與負責人簽名管理規章',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1R7dp1eWYWbbhM4SoHly1dZPdHs0pShHL3OWjMVGcuRI/preview',
          description: '嚴格控管公司大小章及負責人簽名之使用權限與用印紀錄。',
          category: 'org'
        },
        {
          id: 'reg_org_18',
          title: '18. 協調手冊',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1NfBiBdyS7Pf4mlhbsYuZrleas88Ga_t-Sbw4OVfyT8E/preview',
          description: '提供跨部門溝通與衝突解決的指導原則與標準作業程序。',
          category: 'org'
        },
        {
          id: 'reg_org_19',
          title: '19. 如何移轉職責',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/11iA-peENwzDCVinKlT_FMuEjD6hzpjyY9qPAY9XTNtw/preview',
          description: '規範職務輪調或交接時的職責清單盤點與移轉確認流程。',
          category: 'org'
        },
        {
          id: 'reg_org_20',
          title: '20. 如何開始在新職位上運作',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/10Yc-fZfdW_CtTuARuPov0NVvM95YNSTDZ_eVfuYb3-o/preview',
          description: '新進人員或職務異動者在新崗位上的快速上手指南與初期目標設定。',
          category: 'org'
        },
        {
          id: 'reg_org_21',
          title: '21. 企業主10年戰略方針',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1FkCVnLRd0mhCGDsbFaEvoyVZXSDn7NzXwCBhvw7Miss/preview',
          description: '揭示企業未來十年的宏觀發展藍圖與階段性戰略目標。',
          category: 'org'
        },
        {
          id: 'reg_org_22',
          title: '22. 管理等級表(2025年版)',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1_IRQ1fhBttZnYvCnnwtXELGCFAaOYhKrVQFhxdewc3I/preview',
          description: '定義公司內部管理職級體系與對應的職權範圍。',
          category: 'org'
        },
        {
          id: 'reg_org_23',
          title: '23. 個人職務說明培訓',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1JmFMkUXkYe2k3SRL0tNG_IbBl5KtwOr-IJZy48-q7RA/preview',
          description: '針對個人職務說明書內容進行的教育訓練規劃與認證機制。',
          category: 'org'
        },
        {
          id: 'reg_org_24',
          title: '24. 主管的責任',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1eQbbZOSe61-zxRrsyPoUQU9ygNIQX6EgOtcADgSOM4A/preview',
          description: '明確界定各級主管應負的領導統御、人才培育與績效當責。',
          category: 'org'
        },
        {
          id: 'reg_org_25',
          title: '25. 腦力激盪',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1zDHVImzFwPgxILJje9qjSQFZu5OiQ_WtHlWNFOuQ0PM/preview',
          description: '規範創意發想會議的進行方式，鼓勵創新與開放討論的文化。',
          category: 'org'
        },
        {
          id: 'reg_org_26',
          title: '26. 應付與組織規章',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1Ec6bN0ePj2iLtJNicWaimW71AeynIfgT7REUyV5bzJw/preview',
          description: '處理組織內部突發狀況或外部危機的應變機制與權責劃分。',
          category: 'org'
        },
        {
          id: 'reg_org_27',
          title: '27. 年度計畫規章',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1LSoCk9inoTTUC4BA-yXCss6HiU9mXwapfAOXkzi-0Gg/preview',
          description: '規範年度營運計畫的制定、審核、執行與修正流程。',
          category: 'org'
        },
        {
          id: 'reg_org_28',
          title: '28. 集團行事曆規章',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1VC2NhVz4pfi0dMLiIxrIWkhx2iWLH7BReCfDRoY2xto/preview',
          description: '統一管理集團重要活動、會議與休假日的行事曆發布規則。',
          category: 'org'
        },
        {
          id: 'reg_org_29',
          title: '29. 職員終止契約與職務移轉規章',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1O43I83txCawPkKjiD0nOecEbSgrGWtnmoucxmnFq6nM/preview',
          description: '詳述員工離職時的契約終止程序、資產繳回與工作交接規範。',
          category: 'org'
        },
        {
          id: 'reg_org_30',
          title: '30. 職務說明_公版',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/13y4I-WmtBJZM7Gf2-5Uds0LqfwQYP16n/preview',
          description: '提供標準化的職務說明書範本，用於定義各職位的工作內容。',
          category: 'org'
        },
        {
          id: 'reg_org_31',
          title: '31. 職務職責與運行規章',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/11KSGIeCLfk97jXwmP09DMkhhl0z2O9fwxBoTtjmj54s/preview',
          description: '深入解析職務職責的履行方式與日常運行準則。',
          category: 'org'
        },
        {
          id: 'reg_org_32',
          title: '32. 出差費用管理辦法規章',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1DiCgOu38eg1RpdBXQjUY2qr6RcWn9Uw0ZJesmVnzWCQ/preview',
          description: '規定國內外出差的申請流程、費用報支標準與核銷單據要求。',
          category: 'org'
        },
        {
          id: 'reg_org_33',
          title: '33. 職務移轉規章附件',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1-yTTqGmEaMeq_hVA5wvtuCKfa5hj6cYiBLB-FpGytjA/preview',
          description: '包含職務移轉過程中需填寫的檢核表與相關輔助文件。',
          category: 'org'
        },
        {
          id: 'reg_org_34',
          title: '34. 投資客戶資料管理規則',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/13NNiO_cmzUF2T3egu8phmUijc-lFKASpeNjv-4pjobg/preview',
          description: '嚴格規範投資客戶個資的蒐集、處理、利用與保密措施。',
          category: 'org'
        },
        {
          id: 'reg_org_35',
          title: '35. 戰略與戰術會議規章',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1wMquAiR4Sso1svSW4yub_Bw1XjaZXe47JubtgdjrtgM/preview',
          description: '定義高階戰略會議與執行層面戰術會議的區別與運作模式。',
          category: 'org'
        },
        {
          id: 'reg_org_36',
          title: '36. 企業文件審核規範',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/14rlMJ89loSK-S_wFWkkKkM_xXc2TRKETlzKNDnohRew/preview',
          description: '建立對外發布或內部重要文件的層級審核機制與標準。',
          category: 'org'
        },
        {
          id: 'reg_org_37',
          title: '37. 簽約獎金政策規章',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/18D1Dp3E3zfajABxt8SenCrOY_in4ZWBziJQLU2mwbPs/preview',
          description: '說明業務或專案簽約達成後的獎金計算方式與發放條件。',
          category: 'org'
        },
        {
          id: 'reg_org_38',
          title: '38. 專案管理規章',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1eSRecDt0eCfGVVz0ggKvq35KBXEOsNRHmuFahvH9RXg/preview',
          description: '規範專案從立案、執行、監控到結案的全生命週期管理流程。',
          category: 'org'
        },
        {
          id: 'reg_org_39',
          title: '39. 合約規章',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1OO2wFVBE0IO6pPie8nCVRnd3BysVr2FcK13TuB6m_dc/preview',
          description: '定義公司各類合約的擬定、審閱、用印與歸檔管理辦法。',
          category: 'org'
        },
        {
          id: 'reg_org_40',
          title: '40. 年度目標展開與執行流程規章',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1zwgQyS4rba3aayyNZ8XQvM2wUQa6z1csKlTcozGi_bM/preview',
          description: '說明如何將公司年度目標拆解為部門與個人KPI的執行流程。',
          category: 'org'
        },
        {
          id: 'reg_org_41',
          title: '41. 人力招募與任用',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/13aSUbNn7gz1E-Gcn0Mlp5Tt8uTd6ukdWCXaZPNhE54E/preview',
          description: '規範人才需求申請、面試甄選、核薪至報到任用的標準程序。',
          category: 'org'
        },
        {
          id: 'reg_org_42',
          title: '42. 職員內部公關',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1vIk5lgpCBvVqkjR299-uq0mglQ4L_JFMVb8B96p1ljc/preview',
          description: '建立良好的內部溝通管道與員工關係維護活動之指導原則。',
          category: 'org'
        },
        {
          id: 'reg_org_43',
          title: '43. 感謝小卡',
          date: '2024-05-20',
          url: 'https://docs.google.com/forms/d/e/1FAIpQLSeZvkR5M8M31ryjYwSzj5f3tRnNFf17GVcmsqHo0VTDtufc2w/viewform',
          description: '推動內部感恩文化，提供同仁間互相表達感謝與肯定的機制。',
          category: 'org'
        },
        {
          id: 'reg_org_44',
          title: '44. 穩盈策略顧問股份有限公司_行政管理等級表',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/14ekkF3a2lNY5VGtdep5u6v4-usQ-lkeePc4txia_nHY/preview',
          description: '專屬於穩盈策略顧問的行政職級劃分與管理權限對照表。',
          category: 'org'
        },
        {
          id: 'reg_org_45',
          title: '45. 企業宣傳與教育發布規範',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1lBqwNgG_fX2mlANTlYeDgITpHOxWD8sVgv43t979nWk/preview',
          description: '規範對外行銷宣傳與對內教育訓練教材的製作與發布標準。',
          category: 'org'
        },
        {
          id: 'reg_org_46',
          title: '46. 職災處理辦法',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1vFL9JKH89MYZxtRJl7wOz88-I-Mna1-30y6inRJ9FIo/preview',
          description: '定義職業災害的通報、調查、醫療協助與補償申請流程。',
          category: 'org'
        },
        {
          id: 'reg_org_47',
          title: '47. 文書檔案管理',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1Wq7q3OQp-0LqPYOFmoUvmct5vyMiY2qd/preview',
          description: '規範公司各類紙本與電子檔案的編碼、存放、調閱與銷毀規則。',
          category: 'org'
        },
        {
          id: 'reg_org_48',
          title: '48. 文件審查規章',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/13BVLST5ywds1CTy91HU2498WJ2D1j9NRipKS2pJysRs/preview',
          description: '建立嚴謹的文件審查機制，確保發行文件的正確性與合規性。',
          category: 'org'
        },
        {
          id: 'reg_org_49',
          title: '49. 職員訓練規範與必要性',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1myS9midHkhTC4WIrJNMRld1wsB1sJ56OGxAttYs061g/preview',
          description: '闡述員工教育訓練的體系、必修課程與學習成效評估標準。',
          category: 'org'
        },
        {
          id: 'reg_org_50',
          title: '50. 會議規章',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1lr1oE7VFL8Csr5bWv00aC_-aPI-e9UWYz3PuGhIFJOI/preview',
          description: '規範各類會議的召集、議程安排、記錄與決議事項追蹤管理。',
          category: 'org'
        },
        {
          id: 'reg_org_51',
          title: '51. 流程圖製作與審核',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1zSHcN0Ticx7o375NBkU3M4bdYqv9wA2ge5jn8BSKWWU/preview',
          description: '定義標準作業流程圖(SOP)的繪製符號、格式要求與審核上架流程。',
          category: 'org'
        },
        {
          id: 'reg_org_52',
          title: '52. 法律案件責任與協作管理',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/11oKV6mLijdVG5L9cNJdi0wmhce3MKhLp49s5DB05XOQ/preview',
          description: '規範涉及法律訴訟案件的處理權責、外部律師協作與進度回報機制。',
          category: 'org'
        },
        {
          id: 'reg_org_53',
          title: '53. 獎金與激勵辦法',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1LaZNZfvdwmx3SJicbm8l22j-UHfGJPG7pZzUeEcgVz0/preview',
          description: '說明各類績效獎金、專案獎金的核發標準與激勵制度設計原則。',
          category: 'org'
        },
        {
          id: 'reg_org_54',
          title: '54. 績效管理與考核辦法',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1o8f_penur56ymLaKpJke3cYBGrcjqxB6KDjFSI7q8NE/preview',
          description: '建立公平透明的績效考核制度，包含目標設定、面談與結果應用。',
          category: 'org'
        },
        {
          id: 'reg_org_55',
          title: '55. 薪酬結構辦法',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1qJfjUte_VEVqwMjIYi1vA9Lm_8sRYOD34zBiwpaRUgg/preview',
          description: '定義公司的薪資架構，包含本薪、津貼、獎金等項目的組成原則。',
          category: 'org'
        },
        {
          id: 'reg_org_56',
          title: '56. 職員培訓辦法',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1I-RB7rBn99vvmQMNyh9BVevA13UW3po4LMU6iGZ5Wno/preview',
          description: '詳細規範內外部培訓的申請、費用補助、公假核給與受訓義務。',
          category: 'org'
        },
        {
          id: 'reg_org_57',
          title: '57. 職員發展與晉升辦法',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1NnMTD1e8xLOemtLwQzqVJhkHIm1FX9dvnBPChEGfHAo/preview',
          description: '規劃員工職涯發展路徑，明確定義晉升條件、評選流程與資格認證。',
          category: 'org'
        },

        // --- 技術系列 (Technology) ---
        {
          id: 'reg_tech_1',
          title: '1. 公佈欄發布規章',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1-xUgpXYp5hVb4IYzvmq4KJtxyOwa9Z00YBytMvqPi54/preview',
          description: '規範公司實體與數位公佈欄的資訊張貼、管理維護與下架規則。',
          category: 'tech'
        },
        {
          id: 'reg_tech_2',
          title: '2. 應收帳款分期客戶合約到期展期',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1Ksv32RKYyyloO12G1adtfgZ7A3WQTTNzc_olZAXExLs/preview',
          description: '處理客戶分期合約到期後的續約評估、展期條件與簽約作業流程。',
          category: 'tech'
        },
        {
          id: 'reg_tech_3',
          title: '3. 帳務系統操作手冊',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1xMCeaP-ayd9O6AGueHyTMRS0bbJGvPGLZmz4JNoJslI/preview',
          description: '提供公司內部帳務管理系統的完整操作指南與故障排除說明。',
          category: 'tech'
        },
        {
          id: 'reg_tech_4',
          title: '4. 不動產鑑價作業規章',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1_82d8VjrequcHkIJKNryNNBlOTBYp7Cs9O3ReyChSPU/preview',
          description: '建立標準化的不動產價值評估流程、參考依據與鑑價報告製作規範。',
          category: 'tech'
        },
        {
          id: 'reg_tech_5',
          title: '5. 財富奧秘之旅玩家指南規章',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/15S_ZiwellhyuMvi_6ZqkU9UIhjHYvx_beaeY_5P4fj8/preview',
          description: '財富遊戲化教育訓練的學員參與規則、積分機制與獎勵辦法。',
          category: 'tech'
        },
        {
          id: 'reg_tech_6',
          title: '6. 銀行金鑰管理規章',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1meaTo3hZrCpbVr3utXUu_2G_WI-fAYElqq2HaYv2AKE/preview',
          description: '嚴格控管網路銀行憑證(金鑰)的保管、使用權限與定期更換機制。',
          category: 'tech'
        },
        {
          id: 'reg_tech_7',
          title: '7. 客戶借款違約金減免規範',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/17HSjUqnDgEdTwR3dr_hZjs8fMoTNEcSC/preview',
          description: '定義客戶申請違約金減免的審核標準、授權額度與簽核流程。',
          category: 'tech'
        },
        {
          id: 'reg_tech_8',
          title: '8. 案件授信準則',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1jD6f8k69cWaGDYW599A59oBXUXnPki4J/preview',
          description: '建立貸款案件的風險評估指標、核貸條件與授信額度審查準則。',
          category: 'tech'
        },
        {
          id: 'reg_tech_9',
          title: '9. 案件催收壓力等級表',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1SMH-AgOZAKoTICJj9OF-j6mPeLBx67lJ/preview',
          description: '根據逾期天數與還款狀況，將案件分類並對應不同強度的催收措施。',
          category: 'tech'
        },
        {
          id: 'reg_tech_10',
          title: '10. 個案合約審核及管理辦法',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1LKFe8k9ykFYdW-FKa1cNt2faqG8zczUrOFuNf7EOgZg/preview',
          description: '針對特殊個案合約條款的法務審核流程與後續履約管理規範。',
          category: 'tech'
        },
        {
          id: 'reg_tech_11',
          title: '11. 不動產擔保提供報酬規範',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1TB7iIazCdSpNTQ9xlbU9l4Owa1uYy0R9ZVL9m8aP52k/preview',
          description: '說明第三方提供不動產作為擔保時的報酬計算方式與支付條件。',
          category: 'tech'
        },
        {
          id: 'reg_tech_12',
          title: '12. 案件移轉辦法',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1ZIQ6u0c8melyW2qfIcfQjhNtrHr7RjCqcoBfOoij3HI/preview',
          description: '規範業務人員間案件權益移轉的申請程序、利益分配與責任歸屬。',
          category: 'tech'
        },
        {
          id: 'reg_tech_13',
          title: '13. 投資人會員分級規章',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1SinDUT_rduYlov2kbs32mhf3V6H-Ra1VcPgvRov1rkE/preview',
          description: '依據投資金額與資歷對投資人進行會員分級，並提供差異化服務。',
          category: 'tech'
        },
        {
          id: 'reg_tech_14',
          title: '14. 投資人投資流程規章',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1Mwde1iuceOSp-vRpXuGN5Sz8TwgbQ5rLJLEexVMSf8Y/preview',
          description: '詳細說明投資人從評估標的、簽約入資到完成投資的標準作業程序。',
          category: 'tech'
        },
        {
          id: 'reg_tech_15',
          title: '15. 投資人退資流程規章',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1XuOBsViU9XRXkdrWlZm7P9QDu2fY_DxD1brEmnJL5cg/preview',
          description: '規範投資人申請贖回或合約到期退資的申請期限、審核與撥款流程。',
          category: 'tech'
        },
        {
          id: 'reg_tech_16',
          title: '16. 投資通路管理規範',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1Es4kjY_Ka3feA-3Um3WeHkTLtn0AqoqoQ-drOkArrII/preview',
          description: '管理各類投資資金來源渠道的合作模式、佣金制度與績效評估。',
          category: 'tech'
        },
        {
          id: 'reg_tech_17',
          title: '17. 客戶逾期支付利息管理與減免辦法',
          date: '2024-05-20',
          url: 'https://docs.google.com/document/d/1v-PUTO8GOL4Xnca8bY2bGkPZU5ezo4Dd7N-1SWF9l2Q/preview',
          description: '處理客戶逾期利息的計算、催繳程序以及特殊情況下的減免申請規範。',
          category: 'tech'
        },

        // --- 財務系列 (Finance) ---
        {
          id: 'reg_fin_1',
          title: '1. 財務計畫3.0規章',
          date: '2024-06-01',
          url: 'https://docs.google.com/document/d/1d1Y96RYF7BVznr67jlPZeK-G7l0NoLJCmJzS48js-uU/preview',
          description: '規範公司財務規劃、預算編列及執行監控的第三版核心準則。',
          category: 'finance'
        },
        {
          id: 'reg_fin_2',
          title: '2. 集團內部借貸規則',
          date: '2024-06-01',
          url: 'https://docs.google.com/document/d/1Y4Z7HRLAmPXZst3Bzt3ZFLpgszUcUqFQJyBoN9c_fNE/preview',
          description: '管理集團各子公司間資金調度的借貸程序、利息計算與還款條件。',
          category: 'finance'
        },
        {
          id: 'reg_fin_3',
          title: '3. 借款案件報價與獎勵規章',
          date: '2024-06-01',
          url: 'https://docs.google.com/document/d/1ZvVhP_00-W_KpbqmSRcZybi7TMb49YpFAHB7aPK4KnA/preview',
          description: '定義借款案件的利率定價模型以及業務推廣的獎勵分配機制。',
          category: 'finance'
        },
        {
          id: 'reg_fin_4',
          title: '4. 財務及會計規章',
          date: '2024-06-01',
          url: 'https://docs.google.com/document/d/1alDWigBxatL-w9pdk_OgBeRI7IH5uwqwWeiRbliqOD8/preview',
          description: '建立符合法規的會計帳務處理原則、財務報表編製與稅務申報規範。',
          category: 'finance'
        },

        // --- 行銷系列 (Marketing) ---
        {
          id: 'reg_mkt_1',
          title: '1. 行銷外包規定',
          date: '2024-06-01',
          url: 'https://docs.google.com/document/d/1HanQAEhbq2AwcUQ6si-zVPObSR00Hgxf-8vQGmJC8wA/preview',
          description: '規範行銷專案委外執行的廠商遴選、合約簽訂、驗收與成效評估流程。',
          category: 'marketing'
        },

        // --- 品格系列 (Integrity) ---
        {
          id: 'reg_int_1',
          title: '1. 示知報告規章',
          date: '2024-06-01',
          url: 'https://docs.google.com/document/d/1DQwl2vBspWVvss4bI_8jblDjPAm9-C7s4T9jGPgdteE/preview',
          description: '用於主動通報異常狀況、潛在風險或道德疑慮的標準報告程序。',
          category: 'integrity'
        },
        {
          id: 'reg_int_2',
          title: '2. 品格梯度階層規章',
          date: '2024-06-01',
          url: 'https://docs.google.com/document/d/1fdNprYV3AAqPJ5Lb-DgroRNose8N1vzOpoT1tqXbUMg/preview',
          description: '定義企業內部品格道德的層次標準，作為員工行為準則與獎懲依據。',
          category: 'integrity'
        },
        {
          id: 'reg_int_3',
          title: '3. 狀況公式',
          date: '2024-06-01',
          url: 'https://docs.google.com/document/d/1n3NZnFDRYbCKX2HdfmFNzyDXt0uiSi2OUnE9iaBjAN4/preview',
          description: '應用管理技術中的狀況公式，協助同仁判斷處境並採取正確行動。',
          category: 'integrity'
        },
        {
          id: 'reg_int_4',
          title: '4. 如何清字',
          date: '2024-06-01',
          url: 'https://docs.google.com/document/d/1l_y605Cbgb5ov2dR660sHLWi4TMrZK7QuprJqMeqHyk/preview',
          description: '學習技術：指導如何釐清不懂的字詞，提升學習效率與理解能力。',
          category: 'integrity'
        },
        {
          id: 'reg_int_5',
          title: '5. 多事資料',
          date: '2024-06-01',
          url: 'https://docs.google.com/document/d/10Nt-wP8WNBX80ZcLmna7eodAo5J9p-0V97Jvg4wJgZw/preview',
          description: '說明如何識別與處理組織內部的潛在麻煩製造源與負面影響。',
          category: 'integrity'
        },
        {
          id: 'reg_int_6',
          title: '6. 阻止口頭技術規章',
          date: '2024-06-01',
          url: 'https://docs.google.com/document/d/1GjFhHPYZcbLptKCphDnFzevhC5n0tTmuZU6bYrdPS04/preview',
          description: '強調書面溝通的重要性，減少口頭傳達造成的資訊落差與責任不清。',
          category: 'integrity'
        },
        {
          id: 'reg_int_7',
          title: '7. 生存與動機',
          date: '2024-06-01',
          url: 'https://docs.google.com/document/d/1_krjuq4XBAViuTjQM55EgW51TwJ0bks06uyBu6lvg3Q/preview',
          description: '探討個人與組織生存的動力來源，激發員工正向積極的工作態度。',
          category: 'integrity'
        },
        {
          id: 'reg_int_8',
          title: '8. 快速流動行動週期與品格',
          date: '2024-06-01',
          url: 'https://docs.google.com/document/d/1S5dxCdUybg45vQMCQ6t5QJn0xCbH98dwPdnu6Grc8iY/preview',
          description: '結合高效率執行力與高尚品格，建立正向循環的組織行動週期。',
          category: 'integrity'
        },
        {
          id: 'reg_int_9',
          title: '9. 辦公室戀愛管理規章',
          date: '2024-06-01',
          url: 'https://docs.google.com/document/d/1T6yOfQ3vPctMfPnPXr7vr0B1wQOiYOY5czlbEO48KQ8/preview',
          description: '規範辦公室戀情的申報機制與行為準則，避免公私利益衝突。',
          category: 'integrity'
        },
        {
          id: 'reg_int_10',
          title: '10. 檢視職員的必要性',
          date: '2024-06-01',
          url: 'https://docs.google.com/document/d/1FEuce0ZZtDbDjs9LdDljIzl1p8RT1Qtcqfx9lVAEgmQ/preview',
          description: '定期評估職位存在價值與人員適任性的檢核標準。',
          category: 'integrity'
        },
      ];

      // ==========================================
      // COMPONENTS (組件層)
      // ==========================================

      // 1. LoginGate (登入驗證)
      const LoginGate = ({ onAuthenticated }) => {
        const [password, setPassword] = useState('');
        const [error, setError] = useState(false);
        const [isFading, setIsFading] = useState(false);

        const handleLogin = (e) => {
          e.preventDefault();
          if (password === APP_CONFIG.PASSWORD) {
            localStorage.setItem('km_auth', 'true');
            setIsFading(true);
            setTimeout(() => {
              onAuthenticated();
            }, 600); 
          } else {
            setError(true);
            setPassword('');
          }
        };

        return (
          <div className={`fixed inset-0 z-50 flex flex-col items-center justify-center bg-brand-gray text-white transition-opacity duration-700 ease-in-out ${isFading ? 'opacity-0 pointer-events-none' : 'opacity-100'}`}>
            <div className="w-full max-w-md p-8 bg-white/10 backdrop-blur-md rounded-2xl shadow-2xl border border-white/20 transform transition-all">
              <div className="flex flex-col items-center mb-8">
                <div className="p-4 bg-brand-green rounded-full mb-4 shadow-lg shadow-brand-green/30">
                  <ShieldCheck size={48} className="text-white" />
                </div>
                <h1 className="text-3xl font-bold tracking-wider mb-2">智匯中心</h1>
                <p className="text-gray-300 text-sm">Corporate Knowledge Management System</p>
              </div>
              <form onSubmit={handleLogin} className="space-y-6">
                <div className="relative">
                  <Lock className="absolute left-3 top-3.5 text-gray-400" size={20} />
                  <input
                    type="password"
                    value={password}
                    onChange={(e) => { setPassword(e.target.value); setError(false); }}
                    placeholder="請輸入訪問密碼"
                    className="w-full bg-white/90 text-brand-gray placeholder-gray-500 rounded-lg py-3 pl-10 pr-4 focus:outline-none focus:ring-4 focus:ring-brand-green/50 transition-all font-mono text-lg"
                    autoFocus
                  />
                </div>
                {error && <div className="text-red-400 text-sm text-center font-medium animate-pulse">密碼錯誤，請聯繫管理員索取。</div>}
                <button
                  type="submit"
                  className="w-full bg-brand-green hover:bg-[#1f8c3c] text-white font-bold py-3 rounded-lg shadow-lg flex items-center justify-center gap-2 transition-transform active:scale-95 group"
                >
                  <span>驗證身份</span>
                  <ArrowRight size={20} className="group-hover:translate-x-1 transition-transform" />
                </button>
              </form>
              <div className="mt-8 text-center">
                <p className="text-xs text-gray-400">
                  未經授權請勿嘗試訪問。<br />IP Address Logged for Security.
                </p>
              </div>
            </div>
          </div>
        );
      };

      // 2. Navbar (導覽列 + 清除搜尋按鈕)
      const Navbar = ({ scrollToSection, searchTerm, onSearch, onLogout }) => {
        const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);

        const navLinks = [
          { name: '規章制度', id: 'regulations' },
          { name: '粒子流程表', id: 'flowcharts' },
          { name: '共用表格', id: 'forms' },
        ];

        const handleNavClick = (id) => {
          scrollToSection(id);
          setIsMobileMenuOpen(false);
        };

        const clearSearch = () => {
          onSearch('');
        };

        return (
          <nav className="fixed top-0 left-0 right-0 bg-white/95 backdrop-blur-sm shadow-md z-40 border-b border-gray-100">
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
              <div className="flex justify-between items-center h-16 relative">
                {/* Logo */}
                <div 
                  className="flex-shrink-0 flex items-center gap-2 cursor-pointer z-10" 
                  onClick={() => window.scrollTo({top: 0, behavior: 'smooth'})} 
                >
                  <div className="w-8 h-8 bg-brand-green rounded-lg flex items-center justify-center">
                    <BookOpen className="text-white" size={20} />
                  </div>
                  <span className="font-bold text-xl text-brand-gray tracking-tight">
                    智匯中心<span className="hidden sm:inline">：企業規範導航</span>
                  </span>
                </div>
                {/* Desktop Menu */}
                <div className="hidden md:flex absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 items-center space-x-8">
                  {navLinks.map((link) => (
                    <button
                      key={link.id}
                      onClick={() => handleNavClick(link.id)}
                      className="text-brand-gray hover:text-brand-green font-medium transition-colors duration-200"
                    >
                      {link.name}
                    </button>
                  ))}
                </div>
                {/* Search & Logout */}
                <div className="hidden md:flex items-center gap-4 z-10">
                  <div className="relative group">
                    <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 group-focus-within:text-brand-green transition-colors" size={18} />
                    <input
                      type="text"
                      value={searchTerm}
                      onChange={(e) => onSearch(e.target.value)}
                      placeholder="搜尋..."
                      className="pl-10 pr-10 py-2 bg-gray-50 border border-gray-200 rounded-full text-sm focus:outline-none focus:border-brand-green focus:ring-1 focus:ring-brand-green w-48 transition-all focus:w-64"
                    />
                    {searchTerm && (
                      <button
                        onClick={clearSearch}
                        className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 focus:outline-none p-0.5 rounded-full hover:bg-gray-100 transition-colors"
                        title="清除搜尋"
                      >
                        <X size={14} />
                      </button>
                    )}
                  </div>
                  <div className="h-6 w-px bg-gray-200 mx-1"></div>
                  <button
                    onClick={onLogout}
                    className="flex items-center gap-1 text-gray-400 hover:text-brand-gray transition-colors"
                    title="登出系統"
                  >
                    <LogOut size={20} />
                    <span className="text-sm font-medium">登出</span>
                  </button>
                </div>
                {/* Mobile Menu Button */}
                <div className="md:hidden flex items-center">
                  <button
                    onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}
                    className="text-brand-gray hover:text-brand-green focus:outline-none p-2"
                  >
                    {isMobileMenuOpen ? <X size={28} /> : <Menu size={28} />}
                  </button>
                </div>
              </div>
            </div>
            {/* Mobile Dropdown */}
            <div className={`md:hidden overflow-hidden transition-all duration-300 ease-in-out ${isMobileMenuOpen ? 'max-h-80 opacity-100' : 'max-h-0 opacity-0'}`}>
              <div className="px-4 pt-2 pb-4 space-y-2 bg-white border-t border-gray-100 shadow-lg">
                <div className="mb-4 relative">
                  <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" size={18} />
                  <input
                    type="text"
                    value={searchTerm}
                    onChange={(e) => onSearch(e.target.value)}
                    placeholder="搜尋網站內容..."
                    className="w-full pl-10 pr-10 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:outline-none focus:border-brand-green focus:ring-1 focus:ring-brand-green"
                  />
                  {searchTerm && (
                    <button
                      onClick={clearSearch}
                      className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 focus:outline-none p-1 rounded-full hover:bg-gray-100 transition-colors"
                    >
                      <X size={16} />
                    </button>
                  )}
                </div>
                {navLinks.map((link) => (
                  <button
                    key={link.id}
                    onClick={() => handleNavClick(link.id)}
                    className="block w-full text-left px-3 py-3 rounded-md text-base font-medium text-brand-gray hover:bg-green-50 hover:text-brand-green transition-colors"
                  >
                    {link.name}
                  </button>
                ))}
                <div className="border-t border-gray-100 my-2"></div>
                <button
                  onClick={() => { onLogout(); setIsMobileMenuOpen(false); }}
                  className="block w-full text-left px-3 py-3 rounded-md text-base font-medium text-red-500 hover:bg-red-50 transition-colors flex items-center gap-2"
                >
                  <LogOut size={18} />
                  登出系統
                </button>
              </div>
            </div>
          </nav>
        );
      };

      // 3. SectionRegulations (規章制度 - 含Grid與Sticky)
      const SectionRegulations = ({ data, onItemClick, searchTerm }) => {
        const [selectedCategoryId, setSelectedCategoryId] = useState(null);

        useEffect(() => {
          if (searchTerm) setSelectedCategoryId(null);
        }, [searchTerm]);

        const handleCategoryClick = (id) => {
          setSelectedCategoryId(id);
          if (id) {
            const element = document.getElementById('regulations');
            if(element) {
              const yOffset = -80; 
              const y = element.getBoundingClientRect().top + window.pageYOffset + yOffset;
              window.scrollTo({ top: y, behavior: 'smooth' });
            }
          }
        };

        const isSearching = searchTerm.length > 0;
        const isCategorySelected = selectedCategoryId !== null;
        
        const displayData = isSearching 
          ? data 
          : (selectedCategoryId ? data.filter(item => item.category === selectedCategoryId) : []);

        return (
          <div className="bg-white rounded-xl shadow-sm border border-gray-100 overflow-visible min-h-[300px] relative z-30 transition-all duration-300 hover:shadow-md hover:border-brand-green/30">
            {/* Sticky Header */}
            <div className="sticky top-16 z-40 p-5 border-b border-gray-100 flex flex-col justify-center bg-white/95 backdrop-blur-md rounded-t-xl transition-all shadow-sm">
              <div className="flex items-center gap-3 mb-2">
                <div className="bg-green-100 p-2 rounded-lg text-brand-green"> <FileText size={24} /> </div>
                <h2 className="text-2xl font-bold text-brand-gray flex items-center gap-2">
                  規章制度 <span className="text-sm font-normal text-gray-400 ml-1 hidden sm:inline">Regulations</span>
                </h2>
              </div>
              {!isSearching && (
                <div className="flex gap-2 overflow-x-auto scrollbar-hide pb-2 mt-2 w-full">
                  <button
                    onClick={() => handleCategoryClick(null)}
                    className={`whitespace-nowrap px-3 py-1 rounded-full text-sm font-medium border transition-colors ${selectedCategoryId === null ? 'bg-brand-green text-white border-brand-green' : 'bg-white text-gray-500 border-gray-200 hover:border-brand-green hover:text-brand-green'}`}
                  >所有分類</button>
                  {REGULATION_CATEGORIES.map(cat => (
                    <button
                      key={cat.id}
                      onClick={() => handleCategoryClick(cat.id)}
                      className={`whitespace-nowrap px-3 py-1 rounded-full text-sm font-medium border transition-colors ${selectedCategoryId === cat.id ? 'bg-brand-green text-white border-brand-green' : 'bg-white text-gray-500 border-gray-200 hover:border-brand-green hover:text-brand-green'}`}
                    >{cat.name}</button>
                  ))}
                </div>
              )}
            </div>
            {/* Content */}
            <div className="p-6">
              {!isSearching && !isCategorySelected && (
                <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 animate-in fade-in slide-in-from-bottom-4 duration-500">
                  {REGULATION_CATEGORIES.map((cat) => (
                    <button
                      key={cat.id}
                      onClick={() => handleCategoryClick(cat.id)}
                      className="flex flex-col items-center justify-center p-6 border border-gray-100 rounded-xl hover:border-brand-green hover:shadow-lg hover:shadow-brand-green/10 hover:-translate-y-1 transition-all duration-300 group bg-white h-40"
                    >
                      <div className="bg-gray-50 p-4 rounded-full mb-3 group-hover:bg-brand-green transition-colors duration-300">
                        <Folder size={32} className="text-gray-400 group-hover:text-white transition-colors duration-300" />
                      </div>
                      <span className="font-bold text-gray-600 group-hover:text-brand-green transition-colors">{cat.name}</span>
                    </button>
                  ))}
                </div>
              )}
              {(isSearching || isCategorySelected) && (
                <div className="space-y-4 animate-in fade-in slide-in-from-bottom-2 duration-300">
                  {displayData.length === 0 ? (
                    <div className="flex flex-col items-center justify-center text-center py-12 opacity-60">
                      <div className="bg-gray-50 p-4 rounded-full mb-3"> <MousePointerClick size={32} className="text-gray-300" /> </div>
                      <p className="text-gray-400">此分類暫無文件</p>
                      {isCategorySelected && <button onClick={() => handleCategoryClick(null)} className="mt-4 text-brand-green hover:underline">返回分類列表</button>}
                    </div>
                  ) : (
                    <div className="grid gap-3">
                      {displayData.map((item) => (
                        <div
                          key={item.id}
                          onClick={() => onItemClick(item)}
                          className="p-5 border border-gray-100 rounded-lg hover:bg-green-50/30 hover:border-brand-green/30 transition-all group cursor-pointer bg-white shadow-sm hover:shadow-md"
                        >
                          <div className="flex justify-between items-start">
                            <div className="flex-1">
                              <div className="flex items-center gap-2 mb-2">
                                <FolderOpen size={16} className="text-brand-green/70" />
                                <h3 className="text-lg font-bold text-brand-gray group-hover:text-brand-green transition-colors">{item.title}</h3>
                              </div>
                              <p className="text-sm text-gray-500 leading-relaxed pl-6 border-l-2 border-gray-100 group-hover:border-brand-green/30 transition-colors">{item.description}</p>
                            </div>
                            <div className="flex flex-col items-end gap-2">
                              {item.isNew && <span className="bg-red-100 text-red-600 text-xs font-bold px-2 py-1 rounded-full shrink-0">NEW</span>}
                              <ChevronRight size={20} className="text-gray-300 group-hover:text-brand-green group-hover:translate-x-1 transition-all mt-1" />
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              )}
            </div>
          </div>
        );
      };

      // 4. SectionFlowcharts
      const SectionFlowcharts = ({ data, onItemClick, searchTerm }) => {
        const [selectedCategoryId, setSelectedCategoryId] = useState(null);

        useEffect(() => { if (searchTerm) setSelectedCategoryId(null); }, [searchTerm]);

        const handleCategoryClick = (id) => {
          setSelectedCategoryId(id);
          if (id) {
            const element = document.getElementById('flowcharts');
            if(element) {
              const yOffset = -80; 
              const y = element.getBoundingClientRect().top + window.pageYOffset + yOffset;
              window.scrollTo({ top: y, behavior: 'smooth' });
            }
          }
        };

        const isSearching = searchTerm.length > 0;
        const isCategorySelected = selectedCategoryId !== null;
        const displayData = isSearching ? data : (selectedCategoryId ? data.filter(item => item.category === selectedCategoryId) : []);

        return (
          <div className="bg-white rounded-xl shadow-sm border border-gray-100 overflow-visible min-h-[300px] relative z-20 transition-all duration-300 hover:shadow-md hover:border-brand-green/30">
            <div className="sticky top-16 z-40 p-5 border-b border-gray-100 flex flex-col justify-center bg-white/95 backdrop-blur-md rounded-t-xl transition-all shadow-sm">
              <div className="flex items-center gap-3 mb-2">
                <div className="bg-green-100 p-2 rounded-lg text-brand-green"> <Activity size={24} /> </div>
                <h2 className="text-2xl font-bold text-brand-gray flex items-center gap-2">
                  粒子流程表 <span className="text-sm font-normal text-gray-400 ml-1 hidden sm:inline">Workflows</span>
                </h2>
              </div>
              {!isSearching && (
                <div className="flex gap-2 overflow-x-auto scrollbar-hide pb-2 mt-2 w-full">
                  <button onClick={() => handleCategoryClick(null)} className={`whitespace-nowrap px-3 py-1 rounded-full text-sm font-medium border transition-colors ${selectedCategoryId === null ? 'bg-brand-green text-white border-brand-green' : 'bg-white text-gray-500 border-gray-200 hover:border-brand-green hover:text-brand-green'}`}>所有部門</button>
                  {FLOWCHART_CATEGORIES.map(cat => (
                    <button key={cat.id} onClick={() => handleCategoryClick(cat.id)} className={`whitespace-nowrap px-3 py-1 rounded-full text-sm font-medium border transition-colors ${selectedCategoryId === cat.id ? 'bg-brand-green text-white border-brand-green' : 'bg-white text-gray-500 border-gray-200 hover:border-brand-green hover:text-brand-green'}`}>{cat.name}</button>
                  ))}
                </div>
              )}
            </div>
            <div className="p-6">
              {!isSearching && !isCategorySelected && (
                <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 animate-in fade-in slide-in-from-bottom-4 duration-500">
                  {FLOWCHART_CATEGORIES.map((cat) => (
                    <button key={cat.id} onClick={() => handleCategoryClick(cat.id)} className="flex flex-col items-center justify-center p-6 border border-gray-100 rounded-xl hover:border-brand-green hover:shadow-lg hover:shadow-brand-green/10 hover:-translate-y-1 transition-all duration-300 group bg-white h-40">
                      <div className="bg-gray-50 p-4 rounded-full mb-3 group-hover:bg-brand-green transition-colors duration-300">
                        <Share2 size={32} className="text-gray-400 group-hover:text-white transition-colors duration-300" />
                      </div>
                      <span className="font-bold text-gray-600 group-hover:text-brand-green transition-colors">{cat.name}</span>
                    </button>
                  ))}
                </div>
              )}
              {(isSearching || isCategorySelected) && (
                <div className="space-y-4 animate-in fade-in slide-in-from-bottom-2 duration-300">
                   {displayData.length === 0 ? (
                    <div className="flex flex-col items-center justify-center text-center py-12 opacity-60">
                      <div className="bg-gray-50 p-4 rounded-full mb-3"> <MousePointerClick size={32} className="text-gray-300" /> </div>
                      <p className="text-gray-400">此部門暫無流程文件</p>
                      {isCategorySelected && <button onClick={() => handleCategoryClick(null)} className="mt-4 text-brand-green hover:underline">返回部門列表</button>}
                    </div>
                  ) : (
                    <div className="grid gap-3">
                      {displayData.map((item) => (
                        <div key={item.id} onClick={() => onItemClick(item)} className="p-5 border border-gray-100 rounded-lg hover:bg-green-50/30 hover:border-brand-green/30 transition-all group cursor-pointer bg-white shadow-sm hover:shadow-md">
                          <div className="flex justify-between items-start">
                            <div className="flex-1">
                              <div className="flex items-center gap-2 mb-2">
                                 <GitMerge size={16} className="text-brand-green/70" />
                                 <h3 className="text-lg font-bold text-brand-gray group-hover:text-brand-green transition-colors">{item.title}</h3>
                              </div>
                              <p className="text-sm text-gray-500 leading-relaxed pl-6 border-l-2 border-gray-100 group-hover:border-brand-green/30 transition-colors">{item.description}</p>
                            </div>
                            <ChevronRight size={20} className="text-gray-300 group-hover:text-brand-green group-hover:translate-x-1 transition-all mt-1" />
                          </div>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              )}
            </div>
          </div>
        );
      };

      // 5. SectionForms
      const SectionForms = ({ data, onItemClick, searchTerm }) => {
        const [selectedCategoryId, setSelectedCategoryId] = useState(null);

        useEffect(() => { if (searchTerm) setSelectedCategoryId(null); }, [searchTerm]);

        const handleCategoryClick = (id) => {
          setSelectedCategoryId(id);
          if (id) {
            const element = document.getElementById('forms');
            if(element) {
              const yOffset = -80; 
              const y = element.getBoundingClientRect().top + window.pageYOffset + yOffset;
              window.scrollTo({ top: y, behavior: 'smooth' });
            }
          }
        };

        const isSearching = searchTerm.length > 0;
        const isCategorySelected = selectedCategoryId !== null;
        const displayData = isSearching ? data : (selectedCategoryId ? data.filter(item => item.category === selectedCategoryId) : []);

        return (
          <div className="bg-white rounded-xl shadow-sm border border-gray-100 overflow-visible min-h-[300px] relative z-10 transition-all duration-300 hover:shadow-md hover:border-brand-green/30">
            <div className="sticky top-16 z-40 p-5 border-b border-gray-100 flex flex-col justify-center bg-white/95 backdrop-blur-md rounded-t-xl transition-all shadow-sm">
               <div className="flex items-center gap-3 mb-2">
                  <div className="bg-green-100 p-2 rounded-lg text-brand-green"> <Table size={24} /> </div>
                  <h2 className="text-2xl font-bold text-brand-gray flex items-center gap-2">
                    共用表格 <span className="text-sm font-normal text-gray-400 ml-1 hidden sm:inline">Shared Forms</span>
                  </h2>
               </div>
               {!isSearching && (
                 <div className="flex gap-2 overflow-x-auto scrollbar-hide pb-2 mt-2 w-full">
                   <button onClick={() => handleCategoryClick(null)} className={`whitespace-nowrap px-3 py-1 rounded-full text-sm font-medium border transition-colors ${selectedCategoryId === null ? 'bg-brand-green text-white border-brand-green' : 'bg-white text-gray-500 border-gray-200 hover:border-brand-green hover:text-brand-green'}`}>所有表格</button>
                   {FORM_CATEGORIES.map(cat => (
                     <button key={cat.id} onClick={() => handleCategoryClick(cat.id)} className={`whitespace-nowrap px-3 py-1 rounded-full text-sm font-medium border transition-colors ${selectedCategoryId === cat.id ? 'bg-brand-green text-white border-brand-green' : 'bg-white text-gray-500 border-gray-200 hover:border-brand-green hover:text-brand-green'}`}>{cat.name}</button>
                   ))}
                 </div>
              )}
            </div>
            <div className="p-6">
              {!isSearching && !isCategorySelected && (
                <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 animate-in fade-in slide-in-from-bottom-4 duration-500">
                  {FORM_CATEGORIES.map((cat) => (
                    <button key={cat.id} onClick={() => handleCategoryClick(cat.id)} className="flex flex-col items-center justify-center p-6 border border-gray-100 rounded-xl hover:border-brand-green hover:shadow-lg hover:shadow-brand-green/10 hover:-translate-y-1 transition-all duration-300 group bg-white h-40">
                       <div className="bg-gray-50 p-4 rounded-full mb-3 group-hover:bg-brand-green transition-colors duration-300">
                        <Layers size={32} className="text-gray-400 group-hover:text-white transition-colors duration-300" />
                      </div>
                      <span className="font-bold text-gray-600 group-hover:text-brand-green transition-colors">{cat.name}</span>
                    </button>
                  ))}
                </div>
              )}
              {(isSearching || isCategorySelected) && (
                <div className="space-y-4 animate-in fade-in slide-in-from-bottom-2 duration-300">
                  {displayData.length === 0 ? (
                    <div className="flex flex-col items-center justify-center text-center py-12 opacity-60">
                      <div className="bg-gray-50 p-4 rounded-full mb-3"> <MousePointerClick size={32} className="text-gray-300" /> </div>
                      <p className="text-gray-400">此分類暫無表格</p>
                      {isCategorySelected && <button onClick={() => handleCategoryClick(null)} className="mt-4 text-brand-green hover:underline">返回表格列表</button>}
                    </div>
                  ) : (
                    <div className="grid gap-3">
                      {displayData.map((item) => (
                        <div key={item.id} onClick={() => onItemClick(item)} className="p-5 border border-gray-100 rounded-lg hover:bg-green-50/30 hover:border-brand-green/30 transition-all group cursor-pointer bg-white shadow-sm hover:shadow-md">
                          <div className="flex justify-between items-start">
                            <div className="flex-1">
                              <div className="flex items-center gap-2 mb-2">
                                 <Archive size={16} className="text-brand-green/70" />
                                 <h3 className="text-lg font-bold text-brand-gray group-hover:text-brand-green transition-colors">{item.title}</h3>
                              </div>
                              <p className="text-sm text-gray-500 leading-relaxed pl-6 border-l-2 border-gray-100 group-hover:border-brand-green/30 transition-colors">{item.description}</p>
                            </div>
                            <ChevronRight size={20} className="text-gray-300 group-hover:text-brand-green group-hover:translate-x-1 transition-all mt-1" />
                          </div>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              )}
            </div>
          </div>
        );
      };

      // 6. DocPreviewModal
      const DocPreviewModal = ({ isOpen, onClose, title, url }) => {
        if (!isOpen) return null;

        const getDownloadUrl = (docUrl, format) => {
          try {
            const match = docUrl.match(/\/d\/([a-zA-Z0-9-_]+)/);
            if (match && match[1]) {
              return `https://docs.google.com/document/d/${match[1]}/export?format=${format}`;
            }
          } catch (e) { console.error("URL 解析錯誤", e); }
          return docUrl;
        };

        const pdfUrl = getDownloadUrl(url, 'pdf');
        const wordUrl = getDownloadUrl(url, 'docx');

        return (
          <div className="fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6">
            <div className="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity modal-overlay" onClick={onClose}></div>
            <div className="relative w-full max-w-5xl h-[85vh] bg-white rounded-2xl shadow-2xl flex flex-col overflow-hidden animate-in fade-in zoom-in-95 duration-300 modal-container">
              {/* Header */}
              <div className="flex items-center justify-between px-6 py-4 border-b border-gray-100 bg-gray-50/50 modal-header">
                <h3 className="text-lg font-bold text-brand-gray truncate pr-4">{title}</h3>
                <button onClick={onClose} className="p-2 hover:bg-gray-200 rounded-full transition-colors text-gray-500">
                  <X size={24} />
                </button>
              </div>
              {/* Iframe */}
              <div className="flex-1 bg-gray-100 relative modal-iframe-container">
                <iframe src={url} title={title} className="w-full h-full border-0" allow="autoplay"></iframe>
              </div>
              {/* Footer */}
              <div className="px-6 py-4 border-t border-gray-100 bg-white flex flex-col sm:flex-row justify-end gap-3 modal-footer">
                <button
                  onClick={() => window.print()}
                  className="flex items-center justify-center gap-2 bg-white border border-gray-200 text-gray-700 hover:bg-gray-50 hover:text-brand-gray px-5 py-2.5 rounded-lg font-medium transition-colors"
                  title="列印文件"
                >
                  <Printer size={18} />
                  <span>列印</span>
                </button>
                <a href={wordUrl} target="_blank" rel="noopener noreferrer" className="flex items-center justify-center gap-2 bg-white border border-blue-200 text-blue-700 hover:bg-blue-50 px-5 py-2.5 rounded-lg font-medium transition-colors" title="下載為 Word 檔案">
                  <FileText size={18} /> <span>下載 Word</span>
                </a>
                <a href={pdfUrl} target="_blank" rel="noopener noreferrer" className="flex items-center justify-center gap-2 bg-white border border-gray-200 text-gray-700 hover:bg-gray-50 hover:text-brand-gray px-5 py-2.5 rounded-lg font-medium transition-colors" title="下載為 PDF 檔案">
                  <Download size={18} /> <span>下載 PDF</span>
                </a>
                <a href={url} target="_blank" rel="noopener noreferrer" className="flex items-center justify-center gap-2 bg-brand-green hover:bg-[#1f8c3c] text-white px-5 py-2.5 rounded-lg font-medium transition-transform active:scale-95 shadow-md shadow-brand-green/20">
                  <ExternalLink size={18} /> <span>線上閱讀</span>
                </a>
              </div>
            </div>
          </div>
        );
      };

      // 7. App (Main)
      const App = () => {
        const [isAuthenticated, setIsAuthenticated] = useState(false);
        const [isLoading, setIsLoading] = useState(true);
        const [searchTerm, setSearchTerm] = useState('');
        const [isModalOpen, setIsModalOpen] = useState(false);
        const [currentDoc, setCurrentDoc] = useState(null);

        useEffect(() => {
          const storedAuth = localStorage.getItem('km_auth');
          if (storedAuth === 'true') setIsAuthenticated(true);
          setTimeout(() => setIsLoading(false), 500);
        }, []);

        const handleAuthenticated = () => setIsAuthenticated(true);
        const handleLogout = () => {
          localStorage.removeItem('km_auth');
          setIsAuthenticated(false);
          setSearchTerm('');
          window.scrollTo({ top: 0, behavior: 'auto' });
        };

        const scrollToSection = (id) => {
          const element = document.getElementById(id);
          if (element) {
            const yOffset = -80; 
            const y = element.getBoundingClientRect().top + window.pageYOffset + yOffset;
            window.scrollTo({ top: y, behavior: 'smooth' });
          }
        };

        const handleDocClick = (item) => {
          setCurrentDoc({ title: item.title, url: item.url });
          setIsModalOpen(true);
        };

        const filteredRegulations = REGULATIONS_DATA.filter(item => item.title.toLowerCase().includes(searchTerm.toLowerCase()));
        const filteredFlowcharts = FLOWCHARTS_DATA.filter(item => item.title.toLowerCase().includes(searchTerm.toLowerCase()));
        const filteredForms = FORMS_DATA.filter(item => item.title.toLowerCase().includes(searchTerm.toLowerCase()));

        const hasSearch = searchTerm.length > 0;
        const showRegulations = !hasSearch || filteredRegulations.length > 0;
        const showFlowcharts = !hasSearch || filteredFlowcharts.length > 0;
        const showForms = !hasSearch || filteredForms.length > 0;
        const noResults = hasSearch && !showRegulations && !showFlowcharts && !showForms;

        if (isLoading) return null;

        return (
          <div className="min-h-screen relative font-sans">
            {!isAuthenticated && <LoginGate onAuthenticated={handleAuthenticated} />}
            {currentDoc && (
              <DocPreviewModal 
                isOpen={isModalOpen} 
                onClose={() => setIsModalOpen(false)} 
                title={currentDoc.title} 
                url={currentDoc.url} 
              />
            )}
            <div className={`transition-opacity duration-1000 ${isAuthenticated ? 'opacity-100' : 'opacity-0'}`}>
              {isAuthenticated && (
                <React.Fragment>
                  <Navbar scrollToSection={scrollToSection} searchTerm={searchTerm} onSearch={setSearchTerm} onLogout={handleLogout} />
                  <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-24 pb-32 space-y-16">
                    <div className="bg-gradient-to-r from-brand-gray to-gray-700 rounded-2xl p-8 md:p-12 text-white shadow-xl">
                      <h1 className="text-3xl md:text-4xl font-bold mb-4">歡迎回到智匯中心</h1>
                      <p className="text-gray-200 text-lg max-w-2xl">
                        在此查找最新的規章制度、粒子流程表以及共用表格。<br className="hidden md:block"/>致力於打造透明、高效的資訊共享環境。
                      </p>
                    </div>
                    {searchTerm && <div className="text-gray-500 text-sm">搜尋結果：包含 "{searchTerm}" 的資料</div>}
                    {noResults && (
                      <div className="text-center py-20 text-gray-400 bg-gray-50 rounded-xl border border-dashed border-gray-200">
                        <p className="text-xl font-medium mb-2">找不到符合的資料</p>
                        <p className="text-sm">請嘗試其他關鍵字</p>
                      </div>
                    )}
                    {showRegulations && <section id="regulations"><SectionRegulations data={filteredRegulations} onItemClick={handleDocClick} searchTerm={searchTerm} /></section>}
                    {showFlowcharts && <section id="flowcharts"><SectionFlowcharts data={filteredFlowcharts} onItemClick={handleDocClick} searchTerm={searchTerm} /></section>}
                    {showForms && <section id="forms"><SectionForms data={filteredForms} onItemClick={handleDocClick} searchTerm={searchTerm} /></section>}
                  </main>
                  <footer className="bg-white border-t border-gray-100 py-10">
                    <div className="max-w-7xl mx-auto px-4 text-center text-gray-400 text-sm">
                      <p>© 2024 Corporate Knowledge Portal. Internal Use Only.</p>
                    </div>
                  </footer>
                </React.Fragment>
              )}
            </div>
          </div>
        );
      };

      const root = createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>